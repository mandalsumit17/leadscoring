<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeadPro - Advanced Lead Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'navy-900': '#0f172a',
                        'navy-800': '#1e293b',
                        'navy-700': '#334155',
                        'accent-cyan': '#06b6d4',
                        'accent-purple': '#8b5cf6',
                        'accent-teal': '#14b8a6'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .floating-label input:focus + label,
        .floating-label input:not(:placeholder-shown) + label,
        .floating-label input.filled + label {
            transform: translateY(-1.5rem) scale(0.8);
            color: #06b6d4;
        }
        
        .floating-label label {
            transition: all 0.2s ease;
            transform-origin: left top;
        }

        .form-step {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .form-step.hidden {
            opacity: 0;
            transform: translateX(20px);
            pointer-events: none;
        }
        
        .notification {
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .progress-bar {
            width: 0%;
            transition: width 1s ease-in-out;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .counter {
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Main Container -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-gradient-to-b from-navy-900 to-navy-800 text-white shadow-2xl">
            <!-- Logo Section -->
            <div class="p-6 border-b border-navy-700">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-accent-cyan to-accent-teal rounded-full flex items-center justify-center">
                        <i class="fas fa-rocket text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">LeadPro</h1>
                        <p class="text-xs text-gray-300">Lead Management Suite</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="mt-6">
                <div class="px-4 space-y-2">
                    <button onclick="switchTab('dashboard')" id="tab-dashboard" class="nav-item w-full flex items-center px-4 py-3 text-left rounded-lg transition-all duration-300 hover:bg-navy-700 group">
                        <i class="fas fa-chart-pie w-5 h-5 mr-3 group-hover:text-accent-cyan transition-colors"></i>
                        <span class="font-medium">Dashboard</span>
                    </button>
                    <button onclick="switchTab('leads')" id="tab-leads" class="nav-item w-full flex items-center px-4 py-3 text-left rounded-lg transition-all duration-300 hover:bg-navy-700 group">
                        <i class="fas fa-users w-5 h-5 mr-3 group-hover:text-accent-cyan transition-colors"></i>
                        <span class="font-medium">Lead Entry</span>
                    </button>
                    <button onclick="switchTab('scoring')" id="tab-scoring" class="nav-item w-full flex items-center px-4 py-3 text-left rounded-lg transition-all duration-300 hover:bg-navy-700 group">
                        <i class="fas fa-cogs w-5 h-5 mr-3 group-hover:text-accent-cyan transition-colors"></i>
                        <span class="font-medium">Scoring Rules</span>
                    </button>
                    <button onclick="switchTab('analytics')" id="tab-analytics" class="nav-item w-full flex items-center px-4 py-3 text-left rounded-lg transition-all duration-300 hover:bg-navy-700 group">
                        <i class="fas fa-chart-bar w-5 h-5 mr-3 group-hover:text-accent-cyan transition-colors"></i>
                        <span class="font-medium">Analytics</span>
                    </button>
                    <button onclick="switchTab('feedback')" id="tab-feedback" class="nav-item w-full flex items-center px-4 py-3 text-left rounded-lg transition-all duration-300 hover:bg-navy-700 group">
                        <i class="fas fa-comments w-5 h-5 mr-3 group-hover:text-accent-cyan transition-colors"></i>
                        <span class="font-medium">Feedback</span>
                    </button>
                </div>

                <!-- User Profile -->
                <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-navy-700">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-accent-purple to-accent-cyan rounded-full flex items-center justify-center">
                            <span class="text-sm font-semibold">SJ</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">Sumit Mandal</p>
                            <p class="text-xs text-gray-400">Sales Manager</p>
                        </div>
                        <i class="fas fa-chevron-up text-gray-400"></i>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 id="page-title" class="text-2xl font-bold text-gray-900">Dashboard</h2>
                        <p id="page-subtitle" class="text-sm text-gray-600 mt-1">Welcome back! Here's your lead overview.</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button class="relative p-2 text-gray-600 hover:text-gray-900 transition-colors">
                            <i class="fas fa-bell text-lg"></i>
                            <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                        </button>
                        <button onclick="switchTab('leads')" class="px-4 py-2 bg-gradient-to-r from-accent-cyan to-accent-teal text-white rounded-full hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                            <i class="fas fa-plus mr-2"></i>Add Lead
                        </button>
                    </div>
                </div>
            </header>

            <!-- Dashboard Tab -->
            <div id="dashboard-content" class="tab-content p-6 fade-in">
                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Total Leads</p>
                                <p class="text-3xl font-bold text-gray-900 counter" id="total-leads-counter">0</p>
                                <p class="text-sm text-green-600 mt-1">
                                    <i class="fas fa-arrow-up"></i> +12% from last month
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-users text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Qualified Leads</p>
                                <p class="text-3xl font-bold text-gray-900 counter" id="qualified-leads-counter">0</p>
                                <p class="text-sm text-green-600 mt-1">
                                    <i class="fas fa-arrow-up"></i> +8% from last month
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-check-circle text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Conversion Rate</p>
                                <p class="text-3xl font-bold text-gray-900 counter" id="conversion-rate-counter">0%</p>
                                <p class="text-sm text-green-600 mt-1">
                                    <i class="fas fa-arrow-up"></i> +3% from last month
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-percentage text-white"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Avg. Score</p>
                                <p class="text-3xl font-bold text-gray-900 counter" id="avg-score-counter">0</p>
                                <p class="text-sm text-green-600 mt-1">
                                    <i class="fas fa-arrow-up"></i> +2.5% from last month
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-star text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Lead Distribution</h3>
                        <div class="relative h-64">
                            <canvas id="leadDistributionChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Lead Sources</h3>
                        <div class="relative h-64">
                            <canvas id="leadSourceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lead Entry Tab -->
            <div id="leads-content" class="tab-content p-6 hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Lead Entry Form -->
                    <div class="lg:col-span-1">
                        <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-semibold text-gray-900" id="lead-form-title">Add New Lead</h3>
                                <div class="flex items-center space-x-2">
                                    <button type="button" onclick="loadSampleData()" class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors">
                                        <i class="fas fa-file-import mr-1"></i>Sample Data
                                    </button>
                                    <button type="button" onclick="resetForm()" class="px-3 py-1 text-xs bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
                                        <i class="fas fa-eraser mr-1"></i>Clear Form
                                    </button>
                                    <button id="cancel-edit-btn" onclick="cancelEdit()" class="hidden px-3 py-1 text-sm text-gray-600 hover:text-gray-900 transition-colors">
                                        <i class="fas fa-times mr-1"></i>Cancel
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Progress Bar -->
                            <div class="mb-6">
                                <div class="flex items-center justify-between text-sm font-medium text-gray-500 mb-2">
                                    <span>Step <span id="current-step">1</span> of 4</span>
                                    <span id="progress-text">Basic Information</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div id="progress-bar" class="bg-gradient-to-r from-accent-cyan to-accent-teal h-2 rounded-full transition-all duration-300" style="width: 25%"></div>
                                </div>
                                <p class="text-xs text-blue-600 mt-2 text-center">
                                    <i class="fas fa-info-circle mr-1"></i>Form pre-filled with sample data for demo. Use "Clear Form" to start fresh.
                                </p>
                            </div>

                            <!-- Form Steps Navigation -->
                            <div class="flex space-x-1 mb-6">
                                <button type="button" onclick="showFormStep(1)" id="step-1-btn" class="flex-1 px-3 py-2 text-xs font-medium rounded-lg transition-all duration-200 bg-accent-cyan text-white">
                                    <i class="fas fa-user mr-1"></i>Basic
                                </button>
                                <button type="button" onclick="showFormStep(2)" id="step-2-btn" class="flex-1 px-3 py-2 text-xs font-medium rounded-lg transition-all duration-200 bg-gray-100 text-gray-600 hover:bg-gray-200">
                                    <i class="fas fa-briefcase mr-1"></i>Professional
                                </button>
                                <button type="button" onclick="showFormStep(3)" id="step-3-btn" class="flex-1 px-3 py-2 text-xs font-medium rounded-lg transition-all duration-200 bg-gray-100 text-gray-600 hover:bg-gray-200">
                                    <i class="fas fa-building mr-1"></i>Company
                                </button>
                                <button type="button" onclick="showFormStep(4)" id="step-4-btn" class="flex-1 px-3 py-2 text-xs font-medium rounded-lg transition-all duration-200 bg-gray-100 text-gray-600 hover:bg-gray-200">
                                    <i class="fas fa-chart-line mr-1"></i>Lead Info
                                </button>
                            </div>

                            <form id="leadForm" class="space-y-6">
                                <!-- Step 1: Basic Information -->
                                <div id="form-step-1" class="form-step space-y-5">
                                    <div class="text-center mb-6">
                                        <div class="w-16 h-16 bg-gradient-to-r from-accent-cyan to-accent-teal rounded-full flex items-center justify-center mx-auto mb-3">
                                            <i class="fas fa-user text-white text-2xl"></i>
                                        </div>
                                        <h4 class="text-lg font-semibold text-gray-900">Contact Information</h4>
                                        <p class="text-sm text-gray-500">Basic contact details for the lead</p>
                                    </div>
                                    
                                    <div class="floating-label relative">
                                        <input type="text" id="leadName" placeholder=" " value="John Smith" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                        <label for="leadName" class="absolute left-4 top-3 text-gray-500 pointer-events-none">Full Name *</label>
                                    </div>

                                    <div class="floating-label relative">
                                        <input type="email" id="leadEmail" placeholder=" " value="john.smith@techcorp.com" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                        <label for="leadEmail" class="absolute left-4 top-3 text-gray-500 pointer-events-none">Email Address *</label>
                                    </div>

                                    <div class="floating-label relative">
                                        <input type="tel" id="leadPhone" placeholder=" " value="+1 (555) 123-4567" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                        <label for="leadPhone" class="absolute left-4 top-3 text-gray-500 pointer-events-none">Phone Number *</label>
                                    </div>

                                    <div class="floating-label relative">
                                        <input type="text" id="leadCompany" placeholder=" " value="TechCorp Solutions" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                        <label for="leadCompany" class="absolute left-4 top-3 text-gray-500 pointer-events-none">Company Name *</label>
                                    </div>
                                </div>

                                <!-- Step 2: Professional Details -->
                                <div id="form-step-2" class="form-step space-y-5 hidden">
                                    <div class="text-center mb-6">
                                        <div class="w-16 h-16 bg-gradient-to-r from-accent-cyan to-accent-teal rounded-full flex items-center justify-center mx-auto mb-3">
                                            <i class="fas fa-briefcase text-white text-2xl"></i>
                                        </div>
                                        <h4 class="text-lg font-semibold text-gray-900">Professional Details</h4>
                                        <p class="text-sm text-gray-500">Role and department information</p>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Management Level</label>
                                        <select id="leadManagementLevel" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Management Level</option>
                                            <option value="Owner">Owner</option>
                                            <option value="Founder">Founder</option>
                                            <option value="C suite">C-Suite</option>
                                            <option value="Partner">Partner</option>
                                            <option value="Vp">VP</option>
                                            <option value="Head">Head</option>
                                            <option value="Director" selected>Director</option>
                                            <option value="Manager">Manager</option>
                                            <option value="Senior">Senior</option>
                                            <option value="Entry">Entry</option>
                                            <option value="Intern">Intern</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                                        <select id="leadDepartment" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Department</option>
                                            <option value="C-Suite">C-Suite</option>
                                            <option value="Consulting">Consulting</option>
                                            <option value="Design">Design</option>
                                            <option value="Education">Education</option>
                                            <option value="Engineering & Technical">Engineering & Technical</option>
                                            <option value="Finance">Finance</option>
                                            <option value="Human Resources">Human Resources</option>
                                            <option value="Information Technology" selected>Information Technology</option>
                                            <option value="Legal">Legal</option>
                                            <option value="Marketing">Marketing</option>
                                            <option value="Medical & Health">Medical & Health</option>
                                            <option value="Operations">Operations</option>
                                            <option value="Product">Product</option>
                                            <option value="Sales">Sales</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Function</label>
                                        <select id="leadJobFunction" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Job Function</option>
                                            <option value="IT Director" selected>IT Director</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                                        <select id="leadCountry" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Country</option>
                                            <option value="United States" selected>United States</option>
                                            <option value="Canada">Canada</option>
                                            <option value="United Kingdom">United Kingdom</option>
                                            <option value="Germany">Germany</option>
                                            <option value="France">France</option>
                                            <option value="Australia">Australia</option>
                                            <option value="Japan">Japan</option>
                                            <option value="China">China</option>
                                            <option value="India">India</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Step 3: Company Information -->
                                <div id="form-step-3" class="form-step space-y-5 hidden">
                                    <div class="text-center mb-6">
                                        <div class="w-16 h-16 bg-gradient-to-r from-accent-cyan to-accent-teal rounded-full flex items-center justify-center mx-auto mb-3">
                                            <i class="fas fa-building text-white text-2xl"></i>
                                        </div>
                                        <h4 class="text-lg font-semibold text-gray-900">Company Information</h4>
                                        <p class="text-sm text-gray-500">Company size, industry, and revenue details</p>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Industry</label>
                                        <select id="leadIndustry" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Industry</option>
                                            <option value="technology" selected>Technology</option>
                                            <option value="finance">Finance</option>
                                            <option value="healthcare">Healthcare</option>
                                            <option value="retail">Retail</option>
                                            <option value="manufacturing">Manufacturing</option>
                                            <option value="education">Education</option>
                                            <option value="services">Services</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Company Size</label>
                                        <select id="leadCompanySize" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Company Size</option>
                                            <option value="1-10">1-10 employees</option>
                                            <option value="11-20">11-20 employees</option>
                                            <option value="21-50">21-50 employees</option>
                                            <option value="51-100">51-100 employees</option>
                                            <option value="101-200">101-200 employees</option>
                                            <option value="201-500" selected>201-500 employees</option>
                                            <option value="501-1000">501-1000 employees</option>
                                            <option value="1001-2000">1001-2000 employees</option>
                                            <option value="2001-5000">2001-5000 employees</option>
                                            <option value="5001-10000">5001-10000 employees</option>
                                            <option value="10001+">10001+ employees</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Annual Revenue</label>
                                        <select id="leadAnnualRevenue" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Annual Revenue</option>
                                            <option value="0-499999">Less than $500,000</option>
                                            <option value="500000-999999">$500,000 - $999,999</option>
                                            <option value="1000000-4999999">$1M - $4.99M</option>
                                            <option value="5000000-9999999">$5M - $9.99M</option>
                                            <option value="10000000-49999999" selected>$10M - $49.99M</option>
                                            <option value="50000000-99999999">$50M - $99.99M</option>
                                            <option value="100000000+">$100M or more</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Step 4: Lead Qualification -->
                                <div id="form-step-4" class="form-step space-y-5 hidden">
                                    <div class="text-center mb-6">
                                        <div class="w-16 h-16 bg-gradient-to-r from-accent-cyan to-accent-teal rounded-full flex items-center justify-center mx-auto mb-3">
                                            <i class="fas fa-chart-line text-white text-2xl"></i>
                                        </div>
                                        <h4 class="text-lg font-semibold text-gray-900">Lead Qualification</h4>
                                        <p class="text-sm text-gray-500">Source, budget, and purchase intent</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Lead Source</label>
                                        <select id="leadSource" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Source</option>
                                            <option value="Website">Website Form</option>
                                            <option value="Referral">Referral</option>
                                            <option value="LinkedIn" selected>LinkedIn Campaign</option>
                                            <option value="Event">Industry Event</option>
                                            <option value="ColdCall">Cold Call</option>
                                            <option value="Email">Email Campaign</option>
                                            <option value="PaidAds">Paid Ads</option>
                                            <option value="OrganicSearch">Organic Search</option>
                                            <option value="SocialMedia">Social Media</option>
                                            <option value="Partner">Partner/Channel</option>
                                            <option value="Webinar">Webinar</option>
                                            <option value="Conference">Conference/Expo</option>
                                            <option value="Customer">Existing Customer</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>

                                    <div class="floating-label relative">
                                        <input type="text" id="leadSourceCampaign" placeholder=" " value="Q2 2025 Tech Leaders Campaign" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                        <label for="leadSourceCampaign" class="absolute left-4 top-3 text-gray-500 pointer-events-none">Source Campaign</label>
                                    </div>

                                    <div class="floating-label relative">
                                        <input type="number" id="leadEngagement" placeholder=" " value="7" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" min="1" max="10" required>
                                        <label for="leadEngagement" class="absolute left-4 top-3 text-gray-500 pointer-events-none">Engagement Level (1-10)</label>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Budget Range (USD)</label>
                                        <select id="leadBudget" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Budget Range</option>
                                            <option value="0-9999">Less than $10,000</option>
                                            <option value="10000-49999">$10,000 - $49,999</option>
                                            <option value="50000-99999">$50,000 - $99,999</option>
                                            <option value="100000-499999" selected>$100,000 - $499,999</option>
                                            <option value="500000-999999">$500,000 - $999,999</option>
                                            <option value="1000000+">$1M or more</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Decision Making Authority</label>
                                        <select id="leadDecisionMaker" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Authority Level</option>
                                            <option value="Yes" selected>Primary Decision Maker</option>
                                            <option value="No">Influencer/Recommender</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Purchase Timeframe</label>
                                        <select id="leadTimeframe" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                            <option value="">Select Timeframe</option>
                                            <option value="Immediately">Immediately (urgent need)</option>
                                            <option value="1-3 months" selected>1-3 months</option>
                                            <option value="3-6 months">3-6 months</option>
                                            <option value="6+ months">6+ months (future planning)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Form Navigation -->
                                <div class="flex justify-between pt-6 border-t border-gray-200">
                                    <button type="button" id="prev-step-btn" onclick="previousFormStep()" class="px-6 py-2 text-gray-600 hover:text-gray-900 transition-colors hidden">
                                        <i class="fas fa-arrow-left mr-2"></i>Previous
                                    </button>
                                    <div class="flex-1"></div>
                                    <button type="button" id="next-step-btn" onclick="nextFormStep()" class="px-6 py-2 bg-gradient-to-r from-accent-cyan to-accent-teal text-white rounded-lg font-medium hover:shadow-lg transition-all duration-300">
                                        Next<i class="fas fa-arrow-right ml-2"></i>
                                    </button>
                                    <button type="submit" id="lead-submit-btn" class="hidden px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                                        <i class="fas fa-plus mr-2"></i><span id="submit-btn-text">Add Lead</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Lead List -->                        <div class="lg:col-span-2">
                        <div class="bg-white rounded-2xl shadow-lg card-hover border border-gray-100">
                            <div class="p-6 border-b border-gray-200">
                                <h3 class="text-xl font-semibold text-gray-900">Recent Leads</h3>
                                <p class="text-sm text-gray-500 mt-1">Click on any lead row to view full details</p>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lead</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="leadsTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Lead rows will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scoring Rules Tab -->
            <div id="scoring-content" class="tab-content p-6 hidden">
                <div class="max-w-6xl mx-auto">
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-900 mb-6">Advanced Lead Scoring Configuration</h3>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Industry Weights -->
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="bg-blue-100 text-blue-800 p-2 rounded-lg">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <h4 class="text-lg font-medium text-gray-900">Industry Weights</h4>
                                </div>
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Technology</span>
                                        <input type="number" value="20" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-industry-Technology">
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Finance</span>
                                        <input type="number" value="15" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-industry-Finance">
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Healthcare</span>
                                        <input type="number" value="10" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-industry-Healthcare">
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Retail</span>
                                        <input type="number" value="5" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-industry-Retail">
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Manufacturing</span>
                                        <input type="number" value="8" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-industry-Manufacturing">
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Education</span>
                                        <input type="number" value="7" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-industry-Education">
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Services</span>
                                        <input type="number" value="12" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-industry-Services">
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Other</span>
                                        <input type="number" value="0" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-industry-Other">
                                    </div>
                                </div>
                            </div>

                            <!-- Lead Source Quality -->
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="bg-purple-100 text-purple-800 p-2 rounded-lg">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </div>
                                    <h4 class="text-lg font-medium text-gray-900">Lead Source Quality</h4>
                                </div>
                                <div class="grid grid-cols-1 gap-2">
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Website Form</span>
                                        <input type="number" value="15" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-leadSource-Website">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Referral</span>
                                        <input type="number" value="25" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-leadSource-Referral">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">LinkedIn Campaign</span>
                                        <input type="number" value="10" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-leadSource-LinkedIn">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Industry Event</span>
                                        <input type="number" value="20" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-leadSource-Event">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Cold Call</span>
                                        <input type="number" value="3" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-leadSource-ColdCall">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Email Campaign</span>
                                        <input type="number" value="10" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-leadSource-Email">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Paid Ads</span>
                                        <input type="number" value="8" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-leadSource-PaidAds">
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                        <span class="text-sm font-medium text-gray-700">Organic Search</span>
                                        <input type="number" value="12" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="rule-leadSource-OrganicSearch">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
                            <!-- Company Size Impact -->
                            <div class="bg-green-50 p-6 rounded-xl">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="bg-green-100 text-green-800 p-2 rounded-lg">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <h4 class="text-lg font-medium text-gray-900">Company Size Factor</h4>
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-gray-700">Weight per 100 Employees:</label>
                                    <input type="number" id="rule-companySizeFactor" class="w-full px-3 py-2 border border-gray-300 rounded-lg" value="5" step="1">
                                    <p class="text-xs text-gray-500 mt-1">Score = (Company Size / 100)  Factor</p>
                                </div>
                            </div>

                            <!-- Engagement Level Weight -->
                            <div class="bg-red-50 p-6 rounded-xl">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="bg-red-100 text-red-800 p-2 rounded-lg">
                                        <i class="fas fa-heartbeat"></i>
                                    </div>
                                    <h4 class="text-lg font-medium text-gray-900">Engagement Weight</h4>
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-gray-700">Weight per Engagement Point:</label>
                                    <input type="number" id="rule-engagementWeight" class="w-full px-3 py-2 border border-gray-300 rounded-lg" value="8" step="1">
                                    <p class="text-xs text-gray-500 mt-1">8 points for each engagement level</p>
                                </div>
                            </div>

                            <!-- Decision Maker Bonus -->
                            <div class="bg-indigo-50 p-6 rounded-xl">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="bg-indigo-100 text-indigo-800 p-2 rounded-lg">
                                        <i class="fas fa-user-tie"></i>
                                    </div>
                                    <h4 class="text-lg font-medium text-gray-900">Decision Maker</h4>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <label class="text-gray-700">Is Decision Maker:</label>
                                        <input type="number" id="rule-decisionMaker-Yes" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="25">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <label class="text-gray-700">Not Decision Maker:</label>
                                        <input type="number" id="rule-decisionMaker-No" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
                            <!-- Budget Impact -->
                            <div class="bg-yellow-50 p-6 rounded-xl">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="bg-yellow-100 text-yellow-800 p-2 rounded-lg">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                    <h4 class="text-lg font-medium text-gray-900">Budget Impact</h4>
                                </div>
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">Less than $10,000:</span>
                                        <input type="number" id="rule-budget-0-9999" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="0">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">$10,000 - $49,999:</span>
                                        <input type="number" id="rule-budget-10000-49999" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="5">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">$50,000 - $99,999:</span>
                                        <input type="number" id="rule-budget-50000-99999" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="10">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">$100,000 - $499,999:</span>
                                        <input type="number" id="rule-budget-100000-499999" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="15">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">$500,000 - $999,999:</span>
                                        <input type="number" id="rule-budget-500000-999999" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="20">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">$1M or more:</span>
                                        <input type="number" id="rule-budget-1000000+" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="25">
                                    </div>
                                </div>
                            </div>

                            <!-- Timeframe Impact -->
                            <div class="bg-pink-50 p-6 rounded-xl">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="bg-pink-100 text-pink-800 p-2 rounded-lg">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <h4 class="text-lg font-medium text-gray-900">Timeframe Impact</h4>
                                </div>
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">Immediately:</span>
                                        <input type="number" id="rule-timeframe-Immediately" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="25">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">1-3 months:</span>
                                        <input type="number" id="rule-timeframe-1-3 months" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="15">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">3-6 months:</span>
                                        <input type="number" id="rule-timeframe-3-6 months" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="5">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-700">6+ months:</span>
                                        <input type="number" id="rule-timeframe-6+ months" class="w-20 px-2 py-1 border border-gray-300 rounded text-center" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-lg font-medium text-gray-900">Qualification Threshold</h4>
                                    <p class="text-sm text-gray-600">Minimum score required for lead qualification</p>
                                </div>
                                <input type="number" value="50" class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-center" id="qualification-threshold">
                            </div>
                        </div>

                        <div class="mt-8 flex justify-between items-center">
                            <button id="reset-rules" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-full font-medium hover:bg-gray-300 transition-all duration-300">
                                <i class="fas fa-undo mr-2"></i>Reset Defaults
                            </button>
                            <button onclick="updateScoringRules()" class="px-6 py-3 bg-gradient-to-r from-accent-purple to-accent-cyan text-white rounded-full font-medium hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                                <i class="fas fa-save mr-2"></i>Save Scoring Rules
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics-content" class="tab-content p-6 hidden">
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Conversion Rate</p>
                                <p class="text-3xl font-bold text-green-600" id="conversion-rate">0%</p>
                                <p class="text-sm text-gray-500 mt-1">High quality leads</p>
                            </div>
                            <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-chart-line text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Avg Score</p>
                                <p class="text-3xl font-bold text-blue-600" id="average-score">0</p>
                                <p class="text-sm text-gray-500 mt-1">Lead quality index</p>
                            </div>
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-star text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Top Source</p>
                                <p class="text-xl font-bold text-purple-600" id="top-source">-</p>
                                <p class="text-sm text-gray-500 mt-1">Best performing channel</p>
                            </div>
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-trophy text-white"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Response Time</p>
                                <p class="text-2xl font-bold text-orange-600" id="response-time">< 1hr</p>
                                <p class="text-sm text-gray-500 mt-1">Avg follow-up time</p>
                            </div>
                            <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-clock text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Lead Sources Performance</h3>
                        <div class="relative h-64">
                            <canvas id="sourceChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Monthly Lead Trend</h3>
                        <div class="relative h-64">
                            <canvas id="monthlyTrendChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Score Distribution</h3>
                        <div class="relative h-64">
                            <canvas id="scoreDistributionChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Industry Breakdown</h3>
                        <div class="relative h-64">
                            <canvas id="industryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Conversion Funnel -->
                <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">Conversion Funnel</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-3">
                                <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full" style="width: 100%"></div>
                            </div>
                            <div class="text-2xl font-bold text-blue-600" id="funnel-total">0</div>
                            <div class="text-sm text-gray-500">Total Leads</div>
                        </div>
                        
                        <div class="text-center">
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-3">
                                <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 h-3 rounded-full" id="qualified-progress"></div>
                            </div>
                            <div class="text-2xl font-bold text-yellow-600" id="funnel-qualified">0</div>
                            <div class="text-sm text-gray-500">Qualified (60+)</div>
                        </div>
                        
                        <div class="text-center">
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-3">
                                <div class="bg-gradient-to-r from-green-500 to-green-600 h-3 rounded-full" id="hot-progress"></div>
                            </div>
                            <div class="text-2xl font-bold text-green-600" id="funnel-hot">0</div>
                            <div class="text-sm text-gray-500">Hot Leads (80+)</div>
                        </div>
                        
                        <div class="text-center">
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-3">
                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 h-3 rounded-full" id="converted-progress"></div>
                            </div>
                            <div class="text-2xl font-bold text-purple-600" id="funnel-converted">0</div>
                            <div class="text-sm text-gray-500">Converted</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feedback Tab -->
            <div id="feedback-content" class="tab-content p-6 hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Feedback Form -->
                    <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-900 mb-6">Submit Feedback</h3>
                        <form id="feedbackForm" class="space-y-6">
                            <div class="floating-label relative">
                                <input type="text" id="feedbackName" placeholder=" " class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" required>
                                <label for="feedbackName" class="absolute left-4 top-3 text-gray-500 pointer-events-none">Your Name</label>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Feedback Type</label>
                                <select id="feedbackType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200">
                                    <option value="">Select Type</option>
                                    <option value="bug">Bug Report</option>
                                    <option value="feature">Feature Request</option>
                                    <option value="improvement">Improvement Suggestion</option>
                                    <option value="general">General Feedback</option>
                                    <option value="ui-ux">UI/UX Feedback</option>
                                    <option value="performance">Performance Issue</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Overall Rating</label>
                                <div class="flex space-x-2" id="ratingStars">
                                    <button type="button" onclick="setRating(1)" class="rating-star text-2xl text-gray-300 hover:text-yellow-400 transition-colors"></button>
                                    <button type="button" onclick="setRating(2)" class="rating-star text-2xl text-gray-300 hover:text-yellow-400 transition-colors"></button>
                                    <button type="button" onclick="setRating(3)" class="rating-star text-2xl text-gray-300 hover:text-yellow-400 transition-colors"></button>
                                    <button type="button" onclick="setRating(4)" class="rating-star text-2xl text-gray-300 hover:text-yellow-400 transition-colors"></button>
                                    <button type="button" onclick="setRating(5)" class="rating-star text-2xl text-gray-300 hover:text-yellow-400 transition-colors"></button>
                                </div>
                                <div class="text-sm text-gray-500 mt-1" id="ratingText">Click to rate</div>
                            </div>

                            <div>
                                <label for="feedbackMessage" class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                                <textarea id="feedbackMessage" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-cyan focus:border-transparent transition-all duration-200" placeholder="Tell us about your experience..." required></textarea>
                                <div class="text-xs text-gray-500 mt-1" id="sentimentIndicator"></div>
                            </div>

                            <button type="submit" class="w-full px-6 py-3 bg-gradient-to-r from-accent-purple to-accent-cyan text-white rounded-full font-medium hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                                <i class="fas fa-paper-plane mr-2"></i>Submit Feedback
                            </button>
                        </form>
                    </div>

                    <!-- Feedback Insights -->
                    <div class="space-y-6">
                        <!-- Feedback Summary -->
                        <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Feedback Summary</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600" id="positive-feedback">0</div>
                                    <div class="text-sm text-gray-500">Positive</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-red-600" id="negative-feedback">0</div>
                                    <div class="text-sm text-gray-500">Needs Attention</div>
                                </div>
                            </div>
                        </div>

                        <!-- Average Rating -->
                        <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Average Rating</h3>
                            <div class="flex items-center space-x-2">
                                <div class="text-3xl font-bold text-yellow-500" id="avg-rating">0.0</div>
                                <div class="flex text-yellow-400" id="avg-rating-stars">
                                    <span></span>
                                </div>
                            </div>
                            <div class="text-sm text-gray-500 mt-1" id="total-feedback">Based on 0 feedback submissions</div>
                        </div>

                        <!-- Recent Feedback -->
                        <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Feedback</h3>
                            <div id="recent-feedback" class="space-y-3">
                                <div class="text-sm text-gray-500 text-center py-4">No feedback yet</div>
                            </div>
                        </div>

                        <!-- Feedback Categories -->
                        <div class="bg-white rounded-2xl p-6 shadow-lg card-hover border border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Feedback Categories</h3>
                            <div class="relative h-48">
                                <canvas id="feedbackChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Form Step Navigation
        let currentFormStep = 1;
        const totalFormSteps = 4;

        function showFormStep(step) {
            // Hide all steps
            for (let i = 1; i <= totalFormSteps; i++) {
                const stepElement = document.getElementById(`form-step-${i}`);
                const stepButton = document.getElementById(`step-${i}-btn`);
                if (stepElement) stepElement.classList.add('hidden');
                if (stepButton) {
                    stepButton.classList.remove('bg-accent-cyan', 'text-white');
                    stepButton.classList.add('bg-gray-100', 'text-gray-600', 'hover:bg-gray-200');
                }
            }

            // Show current step
            const currentStepElement = document.getElementById(`form-step-${step}`);
            const currentStepButton = document.getElementById(`step-${step}-btn`);
            if (currentStepElement) currentStepElement.classList.remove('hidden');
            if (currentStepButton) {
                currentStepButton.classList.remove('bg-gray-100', 'text-gray-600', 'hover:bg-gray-200');
                currentStepButton.classList.add('bg-accent-cyan', 'text-white');
            }

            // Update progress
            updateFormProgress(step);
            
            // Update navigation buttons
            updateFormNavigation(step);
            
            currentFormStep = step;
        }

        function updateFormProgress(step) {
            const progressBar = document.getElementById('progress-bar');
            const currentStepSpan = document.getElementById('current-step');
            const progressText = document.getElementById('progress-text');
            
            const progress = (step / totalFormSteps) * 100;
            if (progressBar) progressBar.style.width = `${progress}%`;
            if (currentStepSpan) currentStepSpan.textContent = step;
            
            const stepTitles = [
                'Basic Information',
                'Professional Details', 
                'Company Information',
                'Lead Qualification'
            ];
            if (progressText) progressText.textContent = stepTitles[step - 1];
        }

        function updateFormNavigation(step) {
            const prevBtn = document.getElementById('prev-step-btn');
            const nextBtn = document.getElementById('next-step-btn');
            const submitBtn = document.getElementById('lead-submit-btn');
            
            // Previous button
            if (step === 1) {
                prevBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
            }
            
            // Next/Submit button
            if (step === totalFormSteps) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        function nextFormStep() {
            if (validateCurrentStep() && currentFormStep < totalFormSteps) {
                showFormStep(currentFormStep + 1);
            }
        }

        function previousFormStep() {
            if (currentFormStep > 1) {
                showFormStep(currentFormStep - 1);
            }
        }

        function validateCurrentStep() {
            const currentStepElement = document.getElementById(`form-step-${currentFormStep}`);
            if (!currentStepElement) return true;
            
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('border-red-500');
                    field.focus();
                    isValid = false;
                    
                    // Show error message
                    showNotification('Please fill in all required fields before proceeding.', 'error');
                } else {
                    field.classList.remove('border-red-500');
                }
            });
            
            return isValid;
        }

        function resetForm() {
            document.getElementById('leadForm').reset();
            
            // Clear all input values
            document.getElementById('leadName').value = '';
            document.getElementById('leadEmail').value = '';
            document.getElementById('leadPhone').value = '';
            document.getElementById('leadCompany').value = '';
            document.getElementById('leadSourceCampaign').value = '';
            document.getElementById('leadEngagement').value = '';
            
            // Reset all select elements to default option
            const selects = ['leadManagementLevel', 'leadDepartment', 'leadJobFunction', 'leadCountry', 
                           'leadIndustry', 'leadCompanySize', 'leadAnnualRevenue', 'leadSource', 
                           'leadBudget', 'leadDecisionMaker', 'leadTimeframe'];
            
            selects.forEach(selectId => {
                const selectElement = document.getElementById(selectId);
                if (selectElement) {
                    selectElement.selectedIndex = 0; // Reset to first option (empty)
                }
            });
            
            showFormStep(1);
            editingLeadId = null;
            document.getElementById('lead-form-title').textContent = 'Add New Lead';
            document.getElementById('submit-btn-text').textContent = 'Add Lead';
            document.getElementById('cancel-edit-btn').classList.add('hidden');
        }

        function loadSampleData() {
            // Pre-fill with sample data
            document.getElementById('leadName').value = 'John Smith';
            document.getElementById('leadEmail').value = 'john.smith@techcorp.com';
            document.getElementById('leadPhone').value = '+1 (555) 123-4567';
            document.getElementById('leadCompany').value = 'TechCorp Solutions';
            document.getElementById('leadSourceCampaign').value = 'Q2 2025 Tech Leaders Campaign';
            document.getElementById('leadEngagement').value = '7';
            
            // Set select values
            document.getElementById('leadManagementLevel').value = 'Director';
            document.getElementById('leadDepartment').value = 'Information Technology';
            document.getElementById('leadCountry').value = 'United States';
            document.getElementById('leadIndustry').value = 'technology';
            document.getElementById('leadCompanySize').value = '201-500';
            document.getElementById('leadAnnualRevenue').value = '10000000-49999999';
            document.getElementById('leadSource').value = 'LinkedIn';
            document.getElementById('leadBudget').value = '100000-499999';
            document.getElementById('leadDecisionMaker').value = 'Yes';
            document.getElementById('leadTimeframe').value = '1-3 months';
            
            // Trigger job function update
            updateJobFunctions();
            document.getElementById('leadJobFunction').value = 'IT Director';
            
            // Trigger floating label animation for filled fields
            const floatingInputs = document.querySelectorAll('.floating-label input');
            floatingInputs.forEach(input => {
                if (input.value) {
                    input.classList.add('filled');
                }
            });
            
            showNotification('Sample data loaded successfully!', 'success');
        }

        // Global Variables
        let leads = JSON.parse(localStorage.getItem('leads')) || [];
        let feedbacks = JSON.parse(localStorage.getItem('feedbacks')) || [];
        let feedbackRating = 0;
        let editingLeadId = null;
        let currentLeadModal = null;
        let scoringRules = JSON.parse(localStorage.getItem('scoringRules')) || {
            industry: {
                Technology: 20,
                Finance: 15,
                Healthcare: 10,
                Retail: 5,
                Manufacturing: 8,
                Education: 7,
                Services: 12,
                Other: 0
            },
            companySize: {
                '1-10': 5,
                '11-50': 10,
                '51-200': 15,
                '201-1000': 20,
                '1001-5000': 25,
                '5001+': 30
            },
            engagement: {
                weight: 8 // Multiplier for engagement score (1-10)
            },
            source: {
                Website: 15,
                Referral: 25,
                LinkedIn: 10,
                Event: 20,
                ColdCall: 3,
                Email: 10,
                PaidAds: 8,
                OrganicSearch: 12
            },
            budget: {
                '0-9999': 0,
                '10000-49999': 5,
                '50000-99999': 10,
                '100000-499999': 15,
                '500000-999999': 20,
                '1000000+': 25
            },
            decisionMaker: {
                'Yes': 25,
                'No': 0
            },
            timeframe: {
                'Immediately': 25,
                '1-3 months': 15,
                '3-6 months': 5,
                '6+ months': 0
            },
            managementLevel: {
                'Owner': 30,
                'Founder': 30,
                'C suite': 25,
                'Partner': 22,
                'Vp': 20,
                'Head': 18,
                'Director': 15,
                'Manager': 12,
                'Senior': 10,
                'Entry': 5,
                'Intern': 2
            },
            threshold: 50
        };

        // Department to Job Function mapping
        const departmentJobFunctions = {
            'C-Suite': ['CEO', 'CTO', 'CFO', 'COO', 'CPO', 'CHRO', 'General Manager'],
            'Consulting': ['Management Consultant', 'Strategy Consultant', 'Business Analyst', 'Implementation Consultant'],
            'Design': ['UI/UX Designer', 'Graphic Designer', 'Product Designer', 'Creative Director', 'Design Manager'],
            'Education': ['Teacher', 'Professor', 'Administrator', 'Curriculum Developer', 'Academic Director'],
            'Engineering & Technical': ['Software Engineer', 'DevOps Engineer', 'Data Engineer', 'System Administrator', 'Technical Lead'],
            'Finance': ['Financial Analyst', 'Accountant', 'Controller', 'Treasury Manager', 'Investment Manager'],
            'Human Resources': ['HR Manager', 'Recruiter', 'Training Specialist', 'Compensation Analyst', 'HR Business Partner'],
            'Information Technology': ['IT Manager', 'System Administrator', 'Network Engineer', 'Security Analyst', 'Database Administrator'],
            'Legal': ['Legal Counsel', 'Compliance Officer', 'Contract Manager', 'Paralegal', 'Legal Assistant'],
            'Marketing': ['Marketing Manager', 'Digital Marketing Specialist', 'Content Manager', 'Brand Manager', 'Growth Manager'],
            'Medical & Health': ['Doctor', 'Nurse', 'Healthcare Administrator', 'Medical Researcher', 'Therapist'],
            'Operations': ['Operations Manager', 'Supply Chain Manager', 'Process Improvement', 'Logistics Coordinator'],
            'Product': ['Product Manager', 'Product Owner', 'Product Marketing Manager', 'Product Analyst'],
            'Sales': ['Sales Manager', 'Account Executive', 'Sales Development Rep', 'Customer Success Manager', 'Sales Engineer']
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            switchTab('dashboard');
            updateMetrics();
            renderLeadsTable();
            initializeCharts();
            animateCounters();
            updateFeedbackInsights();
            
            // Initialize form to show step 1
            showFormStep(1);
            
            // Load sample data on initialization
            loadSampleData();
            
            // Initialize department change handler
            document.getElementById('leadDepartment').addEventListener('change', updateJobFunctions);
            
            // Initialize sentiment analysis
            document.getElementById('feedbackMessage').addEventListener('input', analyzeSentiment);
        });

        // Tab Switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active state from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-navy-700', 'text-accent-cyan');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-content').classList.remove('hidden');
            
            // Set active state for selected nav item
            document.getElementById('tab-' + tabName).classList.add('bg-navy-700', 'text-accent-cyan');
            
            // Update page title and subtitle
            const titles = {
                dashboard: { title: 'Dashboard', subtitle: 'Welcome back! Here\'s your lead overview.' },
                leads: { title: 'Lead Entry', subtitle: 'Add and manage your leads.' },
                scoring: { title: 'Scoring Rules', subtitle: 'Configure your lead scoring parameters.' },
                analytics: { title: 'Analytics', subtitle: 'Insights and performance metrics.' },
                feedback: { title: 'Feedback', subtitle: 'Share your experience and view insights.' }
            };
            
            document.getElementById('page-title').textContent = titles[tabName].title;
            document.getElementById('page-subtitle').textContent = titles[tabName].subtitle;
            
            // Refresh charts if switching to analytics
            if (tabName === 'analytics') {
                setTimeout(() => {
                    initializeAnalyticsCharts();
                    updateAnalyticsMetrics();
                }, 100);
            }
            
            // Refresh feedback if switching to feedback
            if (tabName === 'feedback') {
                setTimeout(() => {
                    updateFeedbackInsights();
                    initializeFeedbackChart();
                }, 100);
            }
        }

        // Update Job Functions based on Department
        function updateJobFunctions() {
            const department = document.getElementById('leadDepartment').value;
            const jobFunctionSelect = document.getElementById('leadJobFunction');
            
            // Clear existing options
            jobFunctionSelect.innerHTML = '<option value="">Select Job Function</option>';
            
            if (department && departmentJobFunctions[department]) {
                departmentJobFunctions[department].forEach(func => {
                    const option = document.createElement('option');
                    option.value = func;
                    option.textContent = func;
                    jobFunctionSelect.appendChild(option);
                });
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            switchTab('dashboard');
            updateMetrics();
            renderLeadsTable();
            initializeCharts();
            animateCounters();
            
            // Load scoring rules into UI
            loadScoringRulesToUI();
            
            // Add event listener for reset button
            const resetButton = document.getElementById('reset-rules');
            if (resetButton) {
                resetButton.addEventListener('click', resetScoringRules);
            }
        });

        // Tab Switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Remove active state from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-navy-700', 'border-l-4', 'border-accent-cyan');
            });

            // Show selected tab content
            document.getElementById(tabName + '-content').classList.remove('hidden');
            document.getElementById(tabName + '-content').classList.add('fade-in');

            // Add active state to selected nav item
            const activeTab = document.getElementById('tab-' + tabName);
            activeTab.classList.add('bg-navy-700', 'border-l-4', 'border-accent-cyan');

            // Update page title and subtitle
            const titles = {
                dashboard: { title: 'Dashboard', subtitle: 'Welcome back! Here\'s your lead overview.' },
                leads: { title: 'Lead Management', subtitle: 'Add and manage your leads efficiently.' },
                scoring: { title: 'Scoring Rules', subtitle: 'Configure lead scoring parameters.' },
                analytics: { title: 'Analytics', subtitle: 'Analyze your lead performance and trends.' },
                feedback: { title: 'Feedback', subtitle: 'Share your thoughts and help us improve.' }
            };

            document.getElementById('page-title').textContent = titles[tabName].title;
            document.getElementById('page-subtitle').textContent = titles[tabName].subtitle;

            // Initialize charts for analytics tab
            if (tabName === 'analytics') {
                setTimeout(initializeAnalyticsCharts, 100);
            }
        }

        // Lead Management
        document.getElementById('leadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const leadData = {
                name: document.getElementById('leadName').value,
                email: document.getElementById('leadEmail').value,
                phone: document.getElementById('leadPhone').value,
                company: document.getElementById('leadCompany').value,
                managementLevel: document.getElementById('leadManagementLevel').value,
                department: document.getElementById('leadDepartment').value,
                jobFunction: document.getElementById('leadJobFunction').value,
                companySize: document.getElementById('leadCompanySize').value,
                industry: document.getElementById('leadIndustry').value,
                annualRevenue: document.getElementById('leadAnnualRevenue').value,
                country: document.getElementById('leadCountry').value,
                source: document.getElementById('leadSource').value,
                engagement: document.getElementById('leadEngagement').value,
                budget: document.getElementById('leadBudget').value,
                decisionMaker: document.getElementById('leadDecisionMaker').value,
                timeframe: document.getElementById('leadTimeframe').value,
                sourceCampaign: document.getElementById('leadSourceCampaign').value
            };
            
            leadData.score = calculateLeadScore(leadData);

            if (editingLeadId) {
                // Update existing lead
                const leadIndex = leads.findIndex(lead => lead.id === editingLeadId);
                if (leadIndex !== -1) {
                    leads[leadIndex] = {
                        ...leads[leadIndex],
                        ...leadData,
                        qualified: leadData.score >= scoringRules.threshold,
                        lastUpdated: new Date().toISOString()
                    };
                    showNotification('Lead updated successfully!', 'success');
                    cancelEdit();
                }
            } else {
                // Add new lead
                const lead = {
                    id: Date.now(),
                    ...leadData,
                    dateAdded: new Date().toISOString(),
                    status: leadData.score >= 80 ? 'hot' : (leadData.score >= scoringRules.threshold ? 'qualified' : 'new')
                };
                lead.qualified = lead.score >= scoringRules.threshold;
                leads.push(lead);
                showNotification(`Lead added successfully! Score: ${lead.score}`, 'success');
            }

            localStorage.setItem('leads', JSON.stringify(leads));
            this.reset();
            updateJobFunctions(); // Reset job functions dropdown
            updateMetrics();
            renderLeadsTable();
            updateCharts();
        });

        // Enhanced Lead Scoring Calculation
        function calculateLeadScore(leadData) {
            let score = 0;
            
            // Industry scoring - check both casing variations
            if (leadData.industry) {
                const industryKey = leadData.industry;
                if (scoringRules.industry[industryKey]) {
                    score += scoringRules.industry[industryKey];
                }
            }
            
            // Company size scoring - handle size ranges
            if (leadData.companySize) {
                const sizeKey = leadData.companySize;
                if (scoringRules.companySize[sizeKey]) {
                    score += scoringRules.companySize[sizeKey];
                }
            }
            
            // Engagement scoring (1-10 scale with multiplier)
            if (leadData.engagement) {
                const engagementValue = parseInt(leadData.engagement) || 0;
                score += engagementValue * (scoringRules.engagement.weight || 8);
            }
            
            // Lead source scoring
            if (leadData.source) {
                const sourceKey = leadData.source;
                if (scoringRules.source[sourceKey]) {
                    score += scoringRules.source[sourceKey];
                }
            }
            
            // Budget scoring - handle budget ranges
            if (leadData.budget) {
                let budgetKey = leadData.budget;
                // Convert budget values to range keys
                if (typeof leadData.budget === 'string') {
                    if (leadData.budget.includes('$10,000 - $49,999')) budgetKey = '10000-49999';
                    else if (leadData.budget.includes('$50,000 - $99,999')) budgetKey = '50000-99999';
                    else if (leadData.budget.includes('$100,000 - $499,999')) budgetKey = '100000-499999';
                    else if (leadData.budget.includes('$500,000 - $999,999')) budgetKey = '500000-999999';
                    else if (leadData.budget.includes('$1M')) budgetKey = '1000000+';
                    else if (leadData.budget.includes('Less than $10,000')) budgetKey = '0-9999';
                }
                
                if (scoringRules.budget[budgetKey]) {
                    score += scoringRules.budget[budgetKey];
                }
            }
            
            // Decision maker scoring
            if (leadData.decisionMaker) {
                const decisionKey = leadData.decisionMaker;
                if (scoringRules.decisionMaker[decisionKey]) {
                    score += scoringRules.decisionMaker[decisionKey];
                }
            }
            
            // Timeframe scoring
            if (leadData.timeframe) {
                const timeframeKey = leadData.timeframe;
                if (scoringRules.timeframe[timeframeKey]) {
                    score += scoringRules.timeframe[timeframeKey];
                }
            }
            
            // Management level scoring (if available in scoring rules)
            if (leadData.managementLevel && scoringRules.managementLevel && scoringRules.managementLevel[leadData.managementLevel]) {
                score += scoringRules.managementLevel[leadData.managementLevel];
            }
            
            return Math.min(Math.max(score, 0), 100); // Ensure score is between 0-100
        }

        function renderLeadsTable() {
            const tbody = document.getElementById('leadsTableBody');
            tbody.innerHTML = '';

            leads.slice(-10).reverse().forEach(lead => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors cursor-pointer';
                row.onclick = () => openLeadModal(lead.id);
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-r from-accent-purple to-accent-cyan rounded-full flex items-center justify-center text-white font-semibold text-sm">
                                ${lead.name.charAt(0).toUpperCase()}
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">${lead.name}</div>
                                <div class="text-sm text-gray-500">${lead.email}</div>
                                <div class="text-xs text-gray-400">${lead.phone || ''}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${lead.company || 'N/A'}</div>
                        <div class="text-sm text-gray-500">${lead.industry || 'N/A'}</div>
                        <div class="text-xs text-gray-400">${lead.jobTitle || ''}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${lead.department || 'N/A'}</div>
                        <div class="text-xs text-gray-500">${lead.managementLevel || 'N/A'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${lead.source || 'N/A'}</div>
                        <div class="text-xs text-gray-500">${lead.sourceCampaign || ''}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${lead.score}</div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                            <div class="bg-gradient-to-r from-accent-cyan to-accent-teal h-2 rounded-full" style="width: ${lead.score}%"></div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${lead.qualified ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${lead.qualified ? 'Qualified' : 'Unqualified'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2" onclick="event.stopPropagation()">
                            <button onclick="editLead(${lead.id})" class="text-blue-600 hover:text-blue-900 transition-colors" title="Edit Lead">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteLead(${lead.id})" class="text-red-600 hover:text-red-900 transition-colors" title="Delete Lead">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function deleteLead(id) {
            if (confirm('Are you sure you want to delete this lead?')) {
                leads = leads.filter(lead => lead.id !== id);
                localStorage.setItem('leads', JSON.stringify(leads));
                renderLeadsTable();
                updateMetrics();
                updateCharts();
                showNotification('Lead deleted successfully!', 'success');
                
                // If we're editing the lead being deleted, cancel edit mode
                if (editingLeadId === id) {
                    cancelEdit();
                }
            }
        }

        // Modal Functions
        function openLeadModal(id) {
            const lead = leads.find(l => l.id === id);
            if (!lead) return;

            currentLeadModal = lead;
            const modal = document.getElementById('leadModal');
            const modalContent = document.getElementById('modalContent');

            // Show loading state
            modalContent.innerHTML = `
                <div class="col-span-2 flex items-center justify-center py-12">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan mx-auto"></div>
                        <p class="mt-4 text-gray-600">Loading lead details...</p>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');

            // Simulate loading and then populate with actual content
            setTimeout(() => {
                // Populate modal with lead details
                modalContent.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Contact Information</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Name</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.name}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Email</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.email}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Phone</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.phone || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Country</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.country || 'N/A'}</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Professional Information</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Job Title</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.jobTitle || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Department</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.department || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Job Function</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.jobFunction || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Management Level</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.managementLevel || 'N/A'}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Company Information</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Company</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.company || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Industry</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.industry || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Company Size</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.companySize || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Annual Revenue</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.annualRevenue || 'N/A'}</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Lead Details</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Source</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.source || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Source Campaign</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.sourceCampaign || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Budget</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.budget || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Timeframe</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.timeframe || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Decision Maker</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.decisionMaker || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Engagement Level</label>
                                    <p class="mt-1 text-sm text-gray-900">${lead.engagementLevel || 'N/A'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Lead Score</label>
                                    <p class="mt-1 text-sm font-bold text-accent-cyan">${lead.score}/100</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Status</label>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${lead.qualified ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${lead.qualified ? 'Qualified' : 'Unqualified'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }, 300); // Small delay for professional feel
        }

        function closeLeadModal() {
            const modal = document.getElementById('leadModal');
            modal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
            currentLeadModal = null;
        }

        function editLeadFromModal() {
            if (currentLeadModal) {
                closeLeadModal();
                editLead(currentLeadModal.id);
            }
        }

        // Add keyboard support for modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('leadModal');
                if (!modal.classList.contains('hidden')) {
                    closeLeadModal();
                }
            }
        });

        // Click outside modal to close
        document.getElementById('leadModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeLeadModal();
            }
        });

        function editLead(id) {
            const lead = leads.find(l => l.id === id);
            if (!lead) return;

            // Switch to leads tab if not already there
            switchTab('leads');

            // Go to first step of the form
            showFormStep(1);

            // Populate form with lead data - Contact Information
            document.getElementById('leadName').value = lead.name;
            document.getElementById('leadEmail').value = lead.email;
            document.getElementById('leadPhone').value = lead.phone || '';
            document.getElementById('leadCountry').value = lead.country || '';

            // Professional Information
            document.getElementById('leadDepartment').value = lead.department || '';
            document.getElementById('leadJobFunction').value = lead.jobFunction || '';
            document.getElementById('leadManagementLevel').value = lead.managementLevel || '';

            // Company Information
            document.getElementById('leadCompany').value = lead.company || '';
            document.getElementById('leadIndustry').value = lead.industry || '';
            document.getElementById('leadCompanySize').value = lead.companySize || '';
            document.getElementById('leadAnnualRevenue').value = lead.annualRevenue || '';

            // Lead Details
            document.getElementById('leadSource').value = lead.source || '';
            document.getElementById('leadSourceCampaign').value = lead.sourceCampaign || '';
            document.getElementById('leadEngagement').value = lead.engagement || '';
            document.getElementById('leadBudget').value = lead.budget || '';
            document.getElementById('leadDecisionMaker').value = lead.decisionMaker || '';
            document.getElementById('leadTimeframe').value = lead.timeframe || '';

            // Update job function dropdown based on department
            if (lead.department) {
                updateJobFunctions();
            }

            // Trigger floating label animation for filled fields
            const floatingInputs = document.querySelectorAll('.floating-label input, .floating-label select');
            floatingInputs.forEach(input => {
                if (input.value) {
                    input.classList.add('filled');
                }
            });

            // Update form UI for edit mode
            editingLeadId = id;
            document.getElementById('lead-form-title').textContent = 'Edit Lead';
            document.getElementById('submit-btn-text').textContent = 'Update Lead';
            document.getElementById('cancel-edit-btn').classList.remove('hidden');

            showNotification('Lead loaded for editing', 'info');
        }

        function cancelEdit() {
            resetForm();
        }

        // Metrics and Analytics
        function updateMetrics() {
            const totalLeads = leads.length;
            const qualifiedLeads = leads.filter(lead => lead.qualified).length;
            const conversionRate = totalLeads > 0 ? Math.round((qualifiedLeads / totalLeads) * 100) : 0;
            const avgScore = totalLeads > 0 ? Math.round(leads.reduce((sum, lead) => sum + lead.score, 0) / totalLeads) : 0;

            // Update counter elements
            document.getElementById('total-leads-counter').textContent = totalLeads;
            document.getElementById('qualified-leads-counter').textContent = qualifiedLeads;
            document.getElementById('conversion-rate-counter').textContent = conversionRate + '%';
            document.getElementById('avg-score-counter').textContent = avgScore;

            // Update funnel
            document.getElementById('funnel-total').textContent = totalLeads;
            document.getElementById('funnel-qualified').textContent = qualifiedLeads;
            document.getElementById('funnel-converted').textContent = Math.round(qualifiedLeads * 0.7);

            // Update progress bars
            setTimeout(() => {
                const qualifiedProgress = totalLeads > 0 ? (qualifiedLeads / totalLeads) * 100 : 0;
                const convertedProgress = qualifiedLeads > 0 ? 70 : 0;
                
                document.getElementById('qualified-progress').style.width = qualifiedProgress + '%';
                document.getElementById('converted-progress').style.width = convertedProgress + '%';
            }, 500);
        }

        function animateCounters() {
            const counters = document.querySelectorAll('.counter');
            counters.forEach(counter => {
                const target = parseInt(counter.textContent.replace('%', ''));
                let current = 0;
                const increment = target / 50;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    counter.textContent = Math.round(current) + (counter.textContent.includes('%') ? '%' : '');
                }, 20);
            });
        }

        // Charts
        function initializeCharts() {
            // Lead Distribution Chart (Donut)
            const distCtx = document.getElementById('leadDistributionChart').getContext('2d');
            new Chart(distCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Qualified', 'Unqualified'],
                    datasets: [{
                        data: [
                            leads.filter(lead => lead.qualified).length,
                            leads.filter(lead => !lead.qualified).length
                        ],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderWidth: 0,
                        cutout: '70%'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });

            // Lead Source Chart (Horizontal Bar)
            const sourceCtx = document.getElementById('leadSourceChart').getContext('2d');
            const sourceData = {};
            leads.forEach(lead => {
                sourceData[lead.source] = (sourceData[lead.source] || 0) + 1;
            });

            new Chart(sourceCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sourceData),
                    datasets: [{
                        data: Object.values(sourceData),
                        backgroundColor: ['#06b6d4', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444', '#6366f1'],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function initializeAnalyticsCharts() {
            // Industry Performance Chart
            const industryCtx = document.getElementById('industryChart').getContext('2d');
            const industryData = {};
            leads.forEach(lead => {
                if (lead.industry) {
                    industryData[lead.industry] = (industryData[lead.industry] || 0) + 1;
                }
            });

            new Chart(industryCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(industryData),
                    datasets: [{
                        label: 'Leads by Industry',
                        data: Object.values(industryData),
                        backgroundColor: 'rgba(6, 182, 212, 0.8)',
                        borderColor: 'rgba(6, 182, 212, 1)',
                        borderWidth: 1,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Monthly Trend Chart
            const monthlyCtx = document.getElementById('monthlyTrendChart').getContext('2d');
            const monthlyData = {};
            leads.forEach(lead => {
                const month = new Date(lead.dateAdded).toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                monthlyData[month] = (monthlyData[month] || 0) + 1;
            });

            new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: Object.keys(monthlyData),
                    datasets: [{
                        label: 'Monthly Leads',
                        data: Object.values(monthlyData),
                        borderColor: 'rgba(139, 92, 246, 1)',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(139, 92, 246, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Score Distribution Chart
            const scoreCtx = document.getElementById('scoreDistributionChart').getContext('2d');
            const scoreRanges = { '0-25': 0, '26-50': 0, '51-75': 0, '76-100': 0 };
            leads.forEach(lead => {
                if (lead.score <= 25) scoreRanges['0-25']++;
                else if (lead.score <= 50) scoreRanges['26-50']++;
                else if (lead.score <= 75) scoreRanges['51-75']++;
                else scoreRanges['76-100']++;
            });

            new Chart(scoreCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(scoreRanges),
                    datasets: [{
                        data: Object.values(scoreRanges),
                        backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#06b6d4'],
                        borderWidth: 0,
                        cutout: '60%'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            // This would update existing charts with new data
            // For simplicity, we'll reinitialize them
            setTimeout(() => {
                initializeCharts();
                if (document.getElementById('analytics-content').classList.contains('hidden') === false) {
                    initializeAnalyticsCharts();
                }
            }, 100);
        }

        // Scoring Rules
        function updateScoringRules() {
            // Update industry weights
            scoringRules.industry = {
                Technology: parseInt(document.getElementById('rule-industry-Technology').value) || 0,
                Finance: parseInt(document.getElementById('rule-industry-Finance').value) || 0,
                Healthcare: parseInt(document.getElementById('rule-industry-Healthcare').value) || 0,
                Retail: parseInt(document.getElementById('rule-industry-Retail').value) || 0,
                Manufacturing: parseInt(document.getElementById('rule-industry-Manufacturing').value) || 0,
                Education: parseInt(document.getElementById('rule-industry-Education').value) || 0,
                Services: parseInt(document.getElementById('rule-industry-Services').value) || 0,
                Other: parseInt(document.getElementById('rule-industry-Other').value) || 0
            };

            // Update lead source weights
            scoringRules.source = {
                Website: parseInt(document.getElementById('rule-leadSource-Website').value) || 0,
                Referral: parseInt(document.getElementById('rule-leadSource-Referral').value) || 0,
                LinkedIn: parseInt(document.getElementById('rule-leadSource-LinkedIn').value) || 0,
                Event: parseInt(document.getElementById('rule-leadSource-Event').value) || 0,
                ColdCall: parseInt(document.getElementById('rule-leadSource-ColdCall').value) || 0,
                Email: parseInt(document.getElementById('rule-leadSource-Email').value) || 0,
                PaidAds: parseInt(document.getElementById('rule-leadSource-PaidAds').value) || 0,
                OrganicSearch: parseInt(document.getElementById('rule-leadSource-OrganicSearch').value) || 0
            };

            // Update company size factor
            const companySizeFactor = parseInt(document.getElementById('rule-companySizeFactor').value) || 5;
            scoringRules.companySize = {
                '1-10': Math.round(10 / 100 * companySizeFactor),
                '11-50': Math.round(50 / 100 * companySizeFactor),
                '51-200': Math.round(200 / 100 * companySizeFactor),
                '201-1000': Math.round(1000 / 100 * companySizeFactor),
                '1001-5000': Math.round(5000 / 100 * companySizeFactor),
                '5001+': Math.round(10000 / 100 * companySizeFactor)
            };

            // Update engagement weight
            scoringRules.engagement = {
                weight: parseInt(document.getElementById('rule-engagementWeight').value) || 8
            };

            // Update decision maker weights
            scoringRules.decisionMaker = {
                Yes: parseInt(document.getElementById('rule-decisionMaker-Yes').value) || 0,
                No: parseInt(document.getElementById('rule-decisionMaker-No').value) || 0
            };

            // Update budget weights
            scoringRules.budget = {
                '0-9999': parseInt(document.getElementById('rule-budget-0-9999').value) || 0,
                '10000-49999': parseInt(document.getElementById('rule-budget-10000-49999').value) || 0,
                '50000-99999': parseInt(document.getElementById('rule-budget-50000-99999').value) || 0,
                '100000-499999': parseInt(document.getElementById('rule-budget-100000-499999').value) || 0,
                '500000-999999': parseInt(document.getElementById('rule-budget-500000-999999').value) || 0,
                '1000000+': parseInt(document.getElementById('rule-budget-1000000+').value) || 0
            };

            // Update timeframe weights
            scoringRules.timeframe = {
                'Immediately': parseInt(document.getElementById('rule-timeframe-Immediately').value) || 0,
                '1-3 months': parseInt(document.getElementById('rule-timeframe-1-3 months').value) || 0,
                '3-6 months': parseInt(document.getElementById('rule-timeframe-3-6 months').value) || 0,
                '6+ months': parseInt(document.getElementById('rule-timeframe-6+ months').value) || 0
            };

            // Update qualification threshold
            scoringRules.threshold = parseInt(document.getElementById('qualification-threshold').value) || 50;

            // Save to localStorage
            localStorage.setItem('scoringRules', JSON.stringify(scoringRules));
            
            // Recalculate all lead scores using the complete lead data
            leads.forEach(lead => {
                lead.score = calculateLeadScore(lead);
                lead.qualified = lead.score >= scoringRules.threshold;
            });
            
            localStorage.setItem('leads', JSON.stringify(leads));
            showNotification('Scoring rules updated successfully!', 'success');
            updateMetrics();
            renderLeadsTable();
            updateCharts();
        }

        // Load scoring rules from storage into UI
        function loadScoringRulesToUI() {
            // Load industry weights
            Object.keys(scoringRules.industry).forEach(industry => {
                const element = document.getElementById(`rule-industry-${industry}`);
                if (element) {
                    element.value = scoringRules.industry[industry];
                }
            });

            // Load lead source weights
            Object.keys(scoringRules.source).forEach(source => {
                const element = document.getElementById(`rule-leadSource-${source}`);
                if (element) {
                    element.value = scoringRules.source[source];
                }
            });

            // Load other weights
            const companySizeFactorEl = document.getElementById('rule-companySizeFactor');
            if (companySizeFactorEl) companySizeFactorEl.value = 5; // Default factor

            const engagementWeightEl = document.getElementById('rule-engagementWeight');
            if (engagementWeightEl) engagementWeightEl.value = scoringRules.engagement.weight;

            const decisionMakerYesEl = document.getElementById('rule-decisionMaker-Yes');
            if (decisionMakerYesEl) decisionMakerYesEl.value = scoringRules.decisionMaker.Yes;

            const decisionMakerNoEl = document.getElementById('rule-decisionMaker-No');
            if (decisionMakerNoEl) decisionMakerNoEl.value = scoringRules.decisionMaker.No;

            // Load budget weights
            Object.keys(scoringRules.budget).forEach(budgetRange => {
                const element = document.getElementById(`rule-budget-${budgetRange}`);
                if (element) {
                    element.value = scoringRules.budget[budgetRange];
                }
            });

            // Load timeframe weights
            Object.keys(scoringRules.timeframe).forEach(timeframe => {
                const element = document.getElementById(`rule-timeframe-${timeframe}`);
                if (element) {
                    element.value = scoringRules.timeframe[timeframe];
                }
            });

            // Load qualification threshold
            const thresholdEl = document.getElementById('qualification-threshold');
            if (thresholdEl) thresholdEl.value = scoringRules.threshold;
        }

        // Reset scoring rules to defaults
        function resetScoringRules() {
            const defaultRules = {
                industry: {
                    Technology: 20,
                    Finance: 15,
                    Healthcare: 10,
                    Retail: 5,
                    Manufacturing: 8,
                    Education: 7,
                    Services: 12,
                    Other: 0
                },
                source: {
                    Website: 15,
                    Referral: 25,
                    LinkedIn: 10,
                    Event: 20,
                    ColdCall: 3,
                    Email: 10,
                    PaidAds: 8,
                    OrganicSearch: 12
                },
                companySize: {
                    '1-10': 5,
                    '11-50': 10,
                    '51-200': 15,
                    '201-1000': 20,
                    '1001-5000': 25,
                    '5001+': 30
                },
                engagement: {
                    weight: 8
                },
                decisionMaker: {
                    Yes: 25,
                    No: 0
                },
                budget: {
                    '0-9999': 0,
                    '10000-49999': 5,
                    '50000-99999': 10,
                    '100000-499999': 15,
                    '500000-999999': 20,
                    '1000000+': 25
                },
                timeframe: {
                    'Immediately': 25,
                    '1-3 months': 15,
                    '3-6 months': 5,
                    '6+ months': 0
                },
                threshold: 50
            };

            // Update the global scoringRules object
            scoringRules = defaultRules;
            
            // Update UI with default values
            loadScoringRulesToUI();
            
            // Save to localStorage
            localStorage.setItem('scoringRules', JSON.stringify(scoringRules));
            
            showNotification('Scoring rules reset to defaults!', 'success');
        }

        // Feedback System
        function setRating(rating) {
            feedbackRating = rating;
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('text-yellow-400');
                    star.classList.remove('text-gray-300');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            });
        }

        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const feedback = {
                name: document.getElementById('feedbackName').value,
                type: document.getElementById('feedbackType').value,
                rating: feedbackRating,
                message: document.getElementById('feedbackMessage').value,
                date: new Date().toISOString()
            };

            // In a real app, this would be sent to a server
            console.log('Feedback submitted:', feedback);
            showNotification('Thank you for your feedback!', 'success');
            this.reset();
            setRating(0);
        });

        // Notification System
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };

            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle',
                warning: 'fa-exclamation-triangle'
            };

            notification.className = `notification flex items-center p-4 mb-2 text-white rounded-lg shadow-lg ${colors[type]}`;
            notification.innerHTML = `
                <i class="fas ${icons[type]} mr-3"></i>
                <span class="flex-1">${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-3 text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            `;

            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Sample Data (for demonstration)
        if (leads.length === 0) {
            const sampleLeads = [
                {
                    id: 1,
                    name: 'John Smith',
                    email: 'john@techcorp.com',
                    phone: '+1-555-0123',
                    country: 'United States',
                    jobTitle: 'CTO',
                    department: 'Technology',
                    jobFunction: 'Software Development',
                    managementLevel: 'Executive',
                    company: 'TechCorp Inc.',
                    industry: 'technology',
                    companySize: '500-1000',
                    annualRevenue: '$50M-$100M',
                    source: 'website',
                    sourceCampaign: 'Q4 Tech Summit',
                    engagementLevel: 'High',
                    budget: '$100,000+',
                    decisionMaker: 'Yes',
                    timeframe: '1-3 months',
                    dateAdded: new Date(Date.now() - 86400000).toISOString(),
                    score: 85,
                    qualified: true,
                    status: 'new'
                },
                {
                    id: 2,
                    name: 'Sarah Johnson',
                    email: 'sarah@healthplus.com',
                    phone: '+1-555-0124',
                    country: 'Canada',
                    jobTitle: 'VP of Operations',
                    department: 'Operations',
                    jobFunction: 'Operations Management',
                    managementLevel: 'Senior',
                    company: 'HealthPlus',
                    industry: 'healthcare',
                    companySize: '100-500',
                    annualRevenue: '$10M-$50M',
                    source: 'referral',
                    sourceCampaign: 'Partner Referral Program',
                    engagementLevel: 'Medium',
                    budget: '$50,000-$100,000',
                    decisionMaker: 'Influencer',
                    timeframe: '3-6 months',
                    dateAdded: new Date(Date.now() - 172800000).toISOString(),
                    score: 72,
                    qualified: true,
                    status: 'contacted'
                },
                {
                    id: 3,
                    name: 'Mike Wilson',
                    email: 'mike@financegroup.com',
                    phone: '+1-555-0125',
                    country: 'United Kingdom',
                    jobTitle: 'Financial Analyst',
                    department: 'Finance',
                    jobFunction: 'Financial Analysis',
                    managementLevel: 'Individual Contributor',
                    company: 'Finance Group',
                    industry: 'finance',
                    companySize: '50-100',
                    annualRevenue: '$1M-$10M',
                    source: 'social-media',
                    sourceCampaign: 'LinkedIn Campaign',
                    engagementLevel: 'Low',
                    budget: '$10,000-$50,000',
                    decisionMaker: 'No',
                    timeframe: '6+ months',
                    dateAdded: new Date(Date.now() - 259200000).toISOString(),
                    score: 45,
                    qualified: false,
                    status: 'new'
                }
            ];

            leads = sampleLeads;
            localStorage.setItem('leads', JSON.stringify(leads));
        }
    </script>
    <!-- Lead Details Modal -->
    <div id="leadModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Lead Details</h2>
                <button onclick="closeLeadModal()" class="text-gray-500 hover:text-gray-700 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="modalContent" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Content will be populated by JavaScript -->
            </div>
            
            <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200">
                <button onclick="closeLeadModal()" class="px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors">
                    Close
                </button>
                <button onclick="editLeadFromModal()" class="px-6 py-2 bg-gradient-to-r from-accent-cyan to-accent-teal text-white rounded-full hover:shadow-lg transition-all duration-300">
                    <i class="fas fa-edit mr-2"></i>Edit Lead
                </button>
            </div>
        </div>
    </div>

</body>
</html>
