<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Lead Quality & Quantity Manager</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            padding: 32px;
        }
        @media (min-width: 1024px) {
            .container {
                flex-direction: row;
            }
        }
        .sidebar {
            width: 250px;
            min-width: 200px;
            background-color: #f9fafb;
            border-radius: 10px;
            padding: 20px;
            margin-right: 24px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .section {
            background-color: #f9fafb;
            border-radius: 10px;
            padding: 20px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .tab-button {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-weight: 500;
            color: #4b5563;
            transition: background-color 0.2s, color 0.2s;
            cursor: pointer;
        }
        .tab-button:hover {
            background-color: #e5e7eb;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: #ffffff;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        .tab-button.active .fa-icon {
            color: #ffffff;
        }
        .tab-button .fa-icon {
            margin-right: 12px;
            font-size: 1.2rem;
            color: #6b7280;
        }

        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.5;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            border: none;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: #ffffff;
        }
        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }
        .btn-secondary {
            background-color: #6b7280;
            color: #ffffff;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(107, 114, 128, 0.3);
        }
        .btn-success {
            background-color: #10b981;
            color: #ffffff;
        }
        .btn-success:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }
        .btn-danger {
            background-color: #ef4444;
            color: #ffffff;
        }
        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
        }
        .lead-item {
            display: flex;
            flex-direction: column;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
        }
        .lead-item:last-child {
            border-bottom: none;
        }
        .lead-status-qualified {
            color: #10b981;
            font-weight: 600;
        }
        .lead-status-unqualified {
            color: #ef4444;
            font-weight: 600;
        }
        .progress-bar-container {
            background-color: #e5e7eb;
            border-radius: 9999px;
            height: 12px;
            overflow: hidden;
            margin-top: 8px;
        }
        .progress-bar {
            background-color: #3b82f6;
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }
        .chart-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 10px 0;
        }
        .chart-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chart-label {
            flex-shrink: 0;
            width: 80px; /* Adjust as needed */
            font-size: 0.9rem;
            color: #4b5563;
        }
        .chart-bar-visual {
            flex-grow: 1;
            height: 20px;
            background-color: #a7d3f2;
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
            position: relative;
        }
        .chart-bar-visual span {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            color: #374151;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Notification styles */
        #notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .notification {
            background-color: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .notification.error {
            background-color: #ef4444;
        }
        .notification.show {
            opacity: 1;
        }

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive adjustments */
        @media (max-width: 1023px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                margin-right: 0;
                margin-bottom: 24px;
            }
            .tab-button {
                justify-content: center;
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
            }
            .tab-button {
                padding: 10px;
                font-size: 0.9rem;
            }
            .tab-button .fa-icon {
                margin-right: 8px;
                font-size: 1rem;
            }
            .grid-cols-2 > div {
                padding: 8px;
            }
            .chart-label {
                width: 60px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="notification-container"></div>

    <div class="container">
        <!-- Left Sidebar: Navigation Tabs -->
        <div class="sidebar">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Lead Manager Pro</h2>
            <nav>
                <div id="tab-lead-entry" class="tab-button active" data-tab="lead-entry">
                    <i class="fas fa-plus-circle fa-icon"></i> Add Lead
                </div>
                <div id="tab-scoring-config" class="tab-button" data-tab="scoring-config">
                    <i class="fas fa-cogs fa-icon"></i> Scoring Rules
                </div>
                <div id="tab-leads-list" class="tab-button" data-tab="leads-list">
                    <i class="fas fa-list-alt fa-icon"></i> Lead List
                </div>
                <div id="tab-analytics" class="tab-button" data-tab="analytics">
                    <i class="fas fa-chart-line fa-icon"></i> Analytics
                </div>
                <div id="tab-feedback-insights" class="tab-button" data-tab="feedback-insights">
                    <i class="fas fa-comments fa-icon"></i> Feedback Insights
                </div>
            </nav>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Tab Content: Lead Entry -->
            <div id="lead-entry" class="tab-content active">
                <div class="section">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">New Lead Data Entry</h2>
                    <p class="text-gray-600 mb-6">Enter new lead details. Our system will simulate data hygiene and apply scoring rules instantly.</p>
                    <form id="addLeadForm" class="space-y-4">
                        <div>
                            <label for="leadName" class="block text-sm font-medium text-gray-700 mb-1">Lead Name / Contact Person</label>
                            <input type="text" id="leadName" class="form-input" placeholder="e.g., Emily Chen" required>
                        </div>
                        <div>
                            <label for="leadCompany" class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                            <input type="text" id="leadCompany" class="form-input" placeholder="e.g., Quantum Innovations" required>
                        </div>
                        <div>
                            <label for="leadEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <input type="email" id="leadEmail" class="form-input" placeholder="e.g., emily@quantum.com" required>
                        </div>
                        <div>
                            <label for="leadPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                            <input type="tel" id="leadPhone" class="form-input" placeholder="e.g., +1 555-123-4567" required>
                        </div>
                        <div>
                            <label for="leadManagementLevel" class="block text-sm font-medium text-gray-700 mb-1">Management Level</label>
                            <select id="leadManagementLevel" class="form-input" required>
                                <option value="">Select Management Level</option>
                                <option>Owner</option>
                                <option>Founder</option>
                                <option>C suite</option>
                                <option>Partner</option>
                                <option>Vp</option>
                                <option>Head</option>
                                <option>Director</option>
                                <option>Manager</option>
                                <option>Senior</option>
                                <option>Entry</option>
                                <option>Intern</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadDepartment" class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                            <select id="leadDepartment" class="form-input" required>
                                <option value="">Select Department</option>
                                <option>C-Suite</option>
                                <option>Consulting</option>
                                <option>Design</option>
                                <option>Education</option>
                                <option>Engineering & Technical</option>
                                <option>Finance</option>
                                <option>Human Resources</option>
                                <option>Information Technology</option>
                                <option>Legal</option>
                                <option>Marketing</option>
                                <option>Medical & Health</option>
                                <option>Operations</option>
                                <option>Product</option>
                                <option>Sales</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadJobFunction" class="block text-sm font-medium text-gray-700 mb-1">Job Function</label>
                            <select id="leadJobFunction" class="form-input" required>
                                <option value="">Select Job Function</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadCompanySize" class="block text-sm font-medium text-gray-700 mb-1">Company Size</label>
                            <select id="leadCompanySize" class="form-input" required>
                                <option value="">Select Company Size</option>
                                <option>1-10</option>
                                <option>11-20</option>
                                <option>21-50</option>
                                <option>51-100</option>
                                <option>101-200</option>
                                <option>201-500</option>
                                <option>501-1000</option>
                                <option>1001-2000</option>
                                <option>2001-5000</option>
                                <option>5001-10000</option>
                                <option>10001+</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadIndustry" class="block text-sm font-medium text-gray-700 mb-1">Company Industry</label>
                            <select id="leadIndustry" class="form-input" required>
                                <option value="">Select Company Industry</option>
                                <option>Accounting</option>
                                <option>Agriculture</option>
                                <option>Airlines/Aviation</option>
                                <option>Alternative Dispute Resolution</option>
                                <option>Alternative Medicine</option>
                                <option>Animation</option>
                                <option>Apparel & Fashion</option>
                                <option>Architecture & Planning</option>
                                <option>Arts & Crafts</option>
                                <option>Automotive</option>
                                <option>Aviation & Aerospace</option>
                                <option>Banking</option>
                                <option>Biotechnology</option>
                                <option>Broadcast Media</option>
                                <option>Building Materials</option>
                                <option>Business Supplies & Equipment</option>
                                <option>Capital Markets</option>
                                <option>Chemicals</option>
                                <option>Civic & Social Organization</option>
                                <option>Civil Engineering</option>
                                <option>Commercial Real Estate</option>
                                <option>Computer & Network Security</option>
                                <option>Computer Games</option>
                                <option>Computer Hardware</option>
                                <option>Computer Networking</option>
                                <option>Computer Software</option>
                                <option>Construction</option>
                                <option>Consumer Electronics</option>
                                <option>Consumer Goods</option>
                                <option>Consumer Services</option>
                                <option>Cosmetics</option>
                                <option>Dairy</option>
                                <option>Defense & Space</option>
                                <option>Design</option>
                                <option>E-Learning</option>
                                <option>Education Management</option>
                                <option>Electrical/Electronic Manufacturing</option>
                                <option>Entertainment</option>
                                <option>Environmental Services</option>
                                <option>Events Services</option>
                                <option>Executive Office</option>
                                <option>Facilities Services</option>
                                <option>Farming</option>
                                <option>Financial Services</option>
                                <option>Fine Art</option>
                                <option>Fishery</option>
                                <option>Food & Beverages</option>
                                <option>Food Production</option>
                                <option>Fund-Raising</option>
                                <option>Furniture</option>
                                <option>Gambling & Casinos</option>
                                <option>Glass, Ceramics & Concrete</option>
                                <option>Government Administration</option>
                                <option>Government Relations</option>
                                <option>Graphic Design</option>
                                <option>Health, Wellness & Fitness</option>
                                <option>Higher Education</option>
                                <option>Hospital & Health Care</option>
                                <option>Hospitality</option>
                                <option>Human Resources</option>
                                <option>Import & Export</option>
                                <option>Individual & Family Services</option>
                                <option>Industrial Automation</option>
                                <option>Information Services</option>
                                <option>Information Technology & Services</option>
                                <option>Insurance</option>
                                <option>International Affairs</option>
                                <option>International Trade & Development</option>
                                <option>Internet</option>
                                <option>Investment Banking</option>
                                <option>Investment Management</option>
                                <option>Judiciary</option>
                                <option>Law Enforcement</option>
                                <option>Law Practice</option>
                                <option>Legal Services</option>
                                <option>Legislative Office</option>
                                <option>Leisure, Travel & Tourism</option>
                                <option>Libraries</option>
                                <option>Logistics & Supply Chain</option>
                                <option>Luxury Goods & Jewelry</option>
                                <option>Machinery</option>
                                <option>Management Consulting</option>
                                <option>Maritime</option>
                                <option>Market Research</option>
                                <option>Marketing & Advertising</option>
                                <option>Mechanical or Industrial Engineering</option>
                                <option>Media Production</option>
                                <option>Medical Devices</option>
                                <option>Medical Practice</option>
                                <option>Mental Health Care</option>
                                <option>Military</option>
                                <option>Mining & Metals</option>
                                <option>Motion Pictures & Film</option>
                                <option>Museums & Institutions</option>
                                <option>Music</option>
                                <option>Nanotechnology</option>
                                <option>Newspapers</option>
                                <option>Nonprofit Organization Management</option>
                                <option>Oil & Energy</option>
                                <option>Online Media</option>
                                <option>Outsourcing/Offshoring</option>
                                <option>Package/Freight Delivery</option>
                                <option>Packaging & Containers</option>
                                <option>Paper & Forest Products</option>
                                <option>Performing Arts</option>
                                <option>Pharmaceuticals</option>
                                <option>Philanthropy</option>
                                <option>Photography</option>
                                <option>Plastics</option>
                                <option>Political Organization</option>
                                <option>Primary/Secondary Education</option>
                                <option>Printing</option>
                                <option>Professional Training & Coaching</option>
                                <option>Program Development</option>
                                <option>Public Policy</option>
                                <option>Public Relations & Communications</option>
                                <option>Public Safety</option>
                                <option>Publishing</option>
                                <option>Railroad Manufacture</option>
                                <option>Ranching</option>
                                <option>Real Estate</option>
                                <option>Recreational Facilities & Services</option>
                                <option>Religious Institutions</option>
                                <option>Renewables & Environment</option>
                                <option>Research</option>
                                <option>Restaurants</option>
                                <option>Retail</option>
                                <option>Security & Investigations</option>
                                <option>Semiconductors</option>
                                <option>Shipbuilding</option>
                                <option>Sporting Goods</option>
                                <option>Sports</option>
                                <option>Staffing & Recruiting</option>
                                <option>Supermarkets</option>
                                <option>Telecommunications</option>
                                <option>Textiles</option>
                                <option>Think Tanks</option>
                                <option>Tobacco</option>
                                <option>Translation & Localization</option>
                                <option>Transportation/Trucking/Railroad</option>
                                <option>Utilities</option>
                                <option>Venture Capital & Private Equity</option>
                                <option>Veterinary</option>
                                <option>Warehousing</option>
                                <option>Wholesale</option>
                                <option>Wine & Spirits</option>
                                <option>Wireless</option>
                                <option>Writing & Editing</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadAnnualRevenue" class="block text-sm font-medium text-gray-700 mb-1">Annual Revenue (USD)</label>
                            <select id="leadAnnualRevenue" class="form-input" required>
                                <option value="">Select Annual Revenue</option>
                                <option value="0-499999">Less than $500,000</option>
                                <option value="500000-999999">$500,000 - $999,999</option>
                                <option value="1000000-4999999">$1M - $4.99M</option>
                                <option value="5000000-9999999">$5M - $9.99M</option>
                                <option value="10000000-49999999">$10M - $49.99M</option>
                                <option value="50000000-99999999">$50M - $99.99M</option>
                                <option value="100000000+">$100M or more</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadCountry" class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                            <select id="leadCountry" class="form-input" required>
                                <option value="">Select Country</option>
                                <option>Algeria</option>
                                <option>Angola</option>
                                <option>Benin</option>
                                <option>Botswana</option>
                                <option>Burkina Faso</option>
                                <option>Burundi</option>
                                <option>Cabo Verde</option>
                                <option>Cameroon</option>
                                <option>Central African Republic</option>
                                <option>Chad</option>
                                <option>Comoros</option>
                                <option>Congo</option>
                                <option>Côte D'Ivoire</option>
                                <option>Dem. Rep. Congo</option>
                                <option>Djibouti</option>
                                <option>Egypt</option>
                                <option>Equatorial Guinea</option>
                                <option>Eritrea</option>
                                <option>Ethiopia</option>
                                <option>Gabon</option>
                                <option>The Gambia</option>
                                <option>Ghana</option>
                                <option>Guinea</option>
                                <option>Guinea-Bissau</option>
                                <option>Kenya</option>
                                <option>Lesotho</option>
                                <option>Liberia</option>
                                <option>Libya</option>
                                <option>Madagascar</option>
                                <option>Malawi</option>
                                <option>Mali</option>
                                <option>Mauritania</option>
                                <option>Mauritius</option>
                                <option>Morocco</option>
                                <option>Mozambique</option>
                                <option>Namibia</option>
                                <option>Niger</option>
                                <option>Nigeria</option>
                                <option>Reunion (French)</option>
                                <option>Rwanda</option>
                                <option>São Tomé and Principe</option>
                                <option>Senegal</option>
                                <option>Seychelles</option>
                                <option>Sierra Leone</option>
                                <option>Somalia</option>
                                <option>South Africa</option>
                                <option>South Sudan</option>
                                <option>Sudan</option>
                                <option>Swaziland</option>
                                <option>Tanzania</option>
                                <option>Togo</option>
                                <option>Tunisia</option>
                                <option>Uganda</option>
                                <option>Zambia</option>
                                <option>Zimbabwe</option>
                                <option>Australia</option>
                                <option>New Zealand</option>
                                <option>Austria</option>
                                <option>Belgium</option>
                                <option>Channel Islands</option>
                                <option>Faeroe Islands</option>
                                <option>France</option>
                                <option>Germany</option>
                                <option>Ireland</option>
                                <option>Isle of Man</option>
                                <option>Liechtenstein</option>
                                <option>Luxembourg</option>
                                <option>Netherlands</option>
                                <option>Switzerland</option>
                                <option>United Kingdom</option>
                                <option>China</option>
                                <option>Hong Kong SAR, China</option>
                                <option>Macao SAR, China</option>
                                <option>Mongolia</option>
                                <option>Taiwan</option>
                                <option>Albania</option>
                                <option>Bosnia and Herzegovina</option>
                                <option>Bulgaria</option>
                                <option>Croatia</option>
                                <option>Cyprus</option>
                                <option>Czech Republic</option>
                                <option>Estonia</option>
                                <option>Hungary</option>
                                <option>Kosovo</option>
                                <option>Latvia</option>
                                <option>Lithuania</option>
                                <option>Macedonia</option>
                                <option>Moldova</option>
                                <option>Montenegro</option>
                                <option>Poland</option>
                                <option>Romania</option>
                                <option>Serbia</option>
                                <option>Slovak Republic</option>
                                <option>Slovenia</option>
                                <option>Turkey</option>
                                <option>Argentina</option>
                                <option>Belize</option>
                                <option>Bolivia</option>
                                <option>Brazil</option>
                                <option>Chile</option>
                                <option>Colombia</option>
                                <option>Costa Rica</option>
                                <option>Cuba</option>
                                <option>Curaçao</option>
                                <option>Dominica</option>
                                <option>Dominican Republic</option>
                                <option>Ecuador</option>
                                <option>El Salvador</option>
                                <option>French Guiana</option>
                                <option>Guadeloupe (French)</option>
                                <option>Guatemala</option>
                                <option>Guyana</option>
                                <option>Haiti</option>
                                <option>Honduras</option>
                                <option>Martinique (French)</option>
                                <option>Mexico</option>
                                <option>Nicaragua</option>
                                <option>Panama</option>
                                <option>Paraguay</option>
                                <option>Peru</option>
                                <option>Puerto Rico</option>
                                <option>Suriname</option>
                                <option>Uruguay</option>
                                <option>Venezuela</option>
                                <option>Andorra</option>
                                <option>Greece</option>
                                <option>Israel</option>
                                <option>Italy</option>
                                <option>Malta</option>
                                <option>Monaco</option>
                                <option>Portugal</option>
                                <option>San Marino</option>
                                <option>Spain</option>
                                <option>Vatican</option>
                                <option>Bahrain</option>
                                <option>Iran</option>
                                <option>Iraq</option>
                                <option>Jordan</option>
                                <option>Kuwait</option>
                                <option>Lebanon</option>
                                <option>Oman</option>
                                <option>Qatar</option>
                                <option>Saudi Arabia</option>
                                <option>Syrian Arab Republic</option>
                                <option>United Arab Emirates</option>
                                <option>West Bank & Gaza (Palestinian Authority)</option>
                                <option>Yemen</option>
                                <option>Armenia</option>
                                <option>Azerbaijan</option>
                                <option>Belarus</option>
                                <option>Georgia</option>
                                <option>Kazakhstan</option>
                                <option>Kyrgyz Republic</option>
                                <option>Russia</option>
                                <option>Tajikistan</option>
                                <option>Turkmenistan</option>
                                <option>Ukraine</option>
                                <option>Uzbekistan</option>
                                <option>Antigua and Barbuda</option>
                                <option>Aruba</option>
                                <option>The Bahamas</option>
                                <option>Barbados</option>
                                <option>Bermuda</option>
                                <option>Canada</option>
                                <option>Cayman Islands</option>
                                <option>Greenland</option>
                                <option>Grenada</option>
                                <option>Jamaica</option>
                                <option>Sint Maarten (Dutch part)</option>
                                <option>St. Kitts and Nevis</option>
                                <option>St. Lucia</option>
                                <option>St. Martin (French part)</option>
                                <option>St. Vincent and the Grenadines</option>
                                <option>Trinidad and Tobago</option>
                                <option>Turks and Caicos Islands</option>
                                <option>United States</option>
                                <option>Virgin Islands</option>
                                <option>Dem. People's Rep. Korea</option>
                                <option>Japan</option>
                                <option>Korea</option>
                                <option>American Samoa</option>
                                <option>Fiji</option>
                                <option>French Polynesia</option>
                                <option>Guam</option>
                                <option>Kiribati</option>
                                <option>Marshall Islands</option>
                                <option>Micronesia</option>
                                <option>New Caledonia</option>
                                <option>Northern Mariana Islands</option>
                                <option>Pacific Islands</option>
                                <option>Palau</option>
                                <option>Papua New Guinea</option>
                                <option>Samoa</option>
                                <option>Solomon Islands</option>
                                <option>Tonga</option>
                                <option>Tuvalu</option>
                                <option>Vanuatu</option>
                                <option>Denmark</option>
                                <option>Finland</option>
                                <option>Iceland</option>
                                <option>Norway</option>
                                <option>Sweden</option>
                                <option>Afghanistan</option>
                                <option>Bangladesh</option>
                                <option>Bhutan</option>
                                <option>India</option>
                                <option>Maldives</option>
                                <option>Nepal</option>
                                <option>Pakistan</option>
                                <option>Sri Lanka</option>
                                <option>Brunei</option>
                                <option>Cambodia</option>
                                <option>Indonesia</option>
                                <option>Lao PDR</option>
                                <option>Malaysia</option>
                                <option>Myanmar</option>
                                <option>Philippines</option>
                                <option>Singapore</option>
                                <option>Thailand</option>
                                <option>Timor-Leste</option>
                                <option>Vietnam</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadSource" class="block text-sm font-medium text-gray-700 mb-1">Lead Source</label>
                            <select id="leadSource" class="form-input" required>
                                <option value="">Select Lead Source</option>
                                <option value="Website">Website Form</option>
                                <option value="Referral">Referral</option>
                                <option value="LinkedIn">LinkedIn Campaign</option>
                                <option value="Event">Industry Event</option>
                                <option value="ColdCall">Cold Call</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadEngagement" class="block text-sm font-medium text-gray-700 mb-1">Engagement Level (1-10)</label>
                            <input type="number" id="leadEngagement" class="form-input" min="1" max="10" placeholder="e.g., 7" required>
                        </div>
                        <div>
                            <label for="leadBudget" class="block text-sm font-medium text-gray-700 mb-1">Budget (USD)</label>
                            <select id="leadBudget" class="form-input" required>
                                <option value="">Select Budget</option>
                                <option value="0-9999">Less than $10,000</option>
                                <option value="10000-49999">$10,000 - $49,999</option>
                                <option value="50000-99999">$50,000 - $99,999</option>
                                <option value="100000-499999">$100,000 - $499,999</option>
                                <option value="500000-999999">$500,000 - $999,999</option>
                                <option value="1000000+">$1M or more</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadDecisionMaker" class="block text-sm font-medium text-gray-700 mb-1">Is Decision Maker?</label>
                            <select id="leadDecisionMaker" class="form-input" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadTimeframe" class="block text-sm font-medium text-gray-700 mb-1">Timeframe to Purchase</label>
                            <select id="leadTimeframe" class="form-input" required>
                                <option value="">Select Timeframe</option>
                                <option>Immediately</option>
                                <option>1-3 months</option>
                                <option>3-6 months</option>
                                <option>6+ months</option>
                            </select>
                        </div>
                        <div>
                            <label for="leadSourceCampaign" class="block text-sm font-medium text-gray-700 mb-1">Source Campaign</label>
                            <input type="text" id="leadSourceCampaign" class="form-input" placeholder="e.g., Spring2025-Email" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-full">
                            <i class="fas fa-save mr-2"></i> Add Lead & Calculate Score
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tab Content: Scoring Configuration -->
            <div id="scoring-config" class="tab-content">
                <div class="section">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Define Lead Scoring Rules</h2>
                    <p class="text-gray-600 mb-6">Customize the weights for different lead attributes. These rules directly impact the qualification score.</p>

                    <div id="rules-container" class="space-y-6">
                        <!-- Rule Type: Industry -->
                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-building mr-2 text-blue-500"></i> Industry Weights</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Technology:</label><input type="number" id="rule-industry-Technology" class="form-input flex-shrink-0 w-24" value="20"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Finance:</label><input type="number" id="rule-industry-Finance" class="form-input flex-shrink-0 w-24" value="15"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Healthcare:</label><input type="number" id="rule-industry-Healthcare" class="form-input flex-shrink-0 w-24" value="10"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Retail:</label><input type="number" id="rule-industry-Retail" class="form-input flex-shrink-0 w-24" value="5"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Manufacturing:</label><input type="number" id="rule-industry-Manufacturing" class="form-input flex-shrink-0 w-24" value="8"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Education:</label><input type="number" id="rule-industry-Education" class="form-input flex-shrink-0 w-24" value="7"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Services:</label><input type="number" id="rule-industry-Services" class="form-input flex-shrink-0 w-24" value="12"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Other:</label><input type="number" id="rule-industry-Other" class="form-input flex-shrink-0 w-24" value="0"></div>
                            </div>
                        </div>

                        <!-- Rule Type: Company Size -->
                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-users mr-2 text-green-500"></i> Company Size Impact</h3>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Weight per 100 Employees:</label>
                                <input type="number" id="rule-companySizeFactor" class="form-input" value="5" step="1">
                                <p class="text-xs text-gray-500">e.g., 5 points for every 100 employees. Score = (Company Size / 100) * Factor.</p>
                            </div>
                        </div>

                        <!-- Rule Type: Engagement Level -->
                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-heartbeat mr-2 text-red-500"></i> Engagement Level Weight</h3>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Weight per Engagement Point (1-10):</label>
                                <input type="number" id="rule-engagementWeight" class="form-input" value="8" step="1">
                                <p class="text-xs text-gray-500">e.g., 8 points for each point of engagement level.</p>
                            </div>
                        </div>

                        <!-- Rule Type: Lead Source -->
                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-map-marker-alt mr-2 text-purple-500"></i> Lead Source Quality</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Website Form:</label><input type="number" id="rule-leadSource-Website" class="form-input flex-shrink-0 w-24" value="15"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Referral:</label><input type="number" id="rule-leadSource-Referral" class="form-input flex-shrink-0 w-24" value="25"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">LinkedIn Campaign:</label><input type="number" id="rule-leadSource-LinkedIn" class="form-input flex-shrink-0 w-24" value="10"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Industry Event:</label><input type="number" id="rule-leadSource-Event" class="form-input flex-shrink-0 w-24" value="20"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Cold Call:</label><input type="number" id="rule-leadSource-ColdCall" class="form-input flex-shrink-0 w-24" value="3"></div>
                                <div class="flex items-center gap-2"><label class="text-sm flex-grow">Other:</label><input type="number" id="rule-leadSource-Other" class="form-input flex-shrink-0 w-24" value="0"></div>
                            </div>
                        </div>

                        <!-- Rule Type: Budget -->
                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-dollar-sign mr-2 text-yellow-500"></i> Budget Impact</h3>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Weight per $10,000 Budget:</label>
                                <input type="number" id="rule-budgetFactor" class="form-input" value="1" step="0.1">
                                <p class="text-xs text-gray-500">e.g., 1 point for every $10,000 in budget. Score = (Budget / 10000) * Factor.</p>
                            </div>
                        </div>

                        <!-- Annual Revenue Impact -->
                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-money-bill-wave mr-2 text-green-500"></i> Annual Revenue Impact</h3>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Weight per $1M Revenue:</label>
                                <input type="number" id="rule-revenueFactor" class="form-input" value="2" step="0.1">
                                <p class="text-xs text-gray-500">e.g., 2 points for every $1 million in revenue. Score = (Annual Revenue / 1000000) * Factor.</p>
                            </div>
                        </div>

                        <!-- Decision Maker Impact -->
                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-user-tie mr-2 text-blue-500"></i> Decision Maker Weight</h3>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Weight for Decision Maker:</label>
                                <input type="number" id="rule-decisionMakerWeight" class="form-input" value="10" step="1">
                                <p class="text-xs text-gray-500">e.g., 10 points if the lead is a decision maker.</p>
                            </div>
                        </div>

                        <!-- Timeframe to Purchase Impact -->
                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-calendar-check mr-2 text-purple-500"></i> Timeframe Weight</h3>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Weight for Immediate Purchase:</label>
                                <input type="number" id="rule-timeframeImmediate" class="form-input" value="5" step="1">
                                <p class="text-xs text-gray-500">e.g., 5 points if the lead is ready to purchase immediately.</p>
                            </div>
                        </div>

                        <div class="border rounded-lg p-4 bg-white shadow-sm">
                            <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center"><i class="fas fa-check-circle mr-2 text-blue-500"></i> Qualification Threshold</h3>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Minimum Score for Qualified Lead:</label>
                                <input type="number" id="rule-qualifiedThreshold" class="form-input" value="70" step="1">
                                <p class="text-xs text-gray-500">Leads with a score equal to or above this threshold are marked 'Qualified'.</p>
                            </div>
                        </div>
                    </div>
                    <button id="saveScoringRules" class="btn btn-secondary w-full mt-6">
                        <i class="fas fa-save mr-2"></i> Save Scoring Rules
                    </button>
                </div>
            </div>

            <!-- Tab Content: Lead List -->
            <div id="leads-list" class="tab-content">
                <div class="section flex-grow">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">All Leads & Qualification Status</h2>
                    <p class="text-gray-600 mb-6">Click on a lead to view its detailed scoring breakdown. Provide feedback to improve future lead generation.</p>
                    <div id="leadsList" class="divide-y divide-gray-200 max-h-[600px] overflow-y-auto custom-scrollbar">
                        <!-- Lead items will be injected here -->
                        <p class="text-gray-500 text-center py-4" id="noLeadsMessage">No leads added yet. Navigate to 'Add Lead' to begin!</p>
                    </div>
                </div>
            </div>

            <!-- Tab Content: Analytics -->
            <div id="analytics" class="tab-content">
                <div class="section">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Lead Performance Analytics</h2>
                    <p class="text-gray-600 mb-6">Visualize key metrics to understand current lead quality and quantity.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-blue-50 p-6 rounded-lg shadow-sm text-center">
                            <i class="fas fa-users text-blue-600 text-3xl mb-3"></i>
                            <p class="text-lg font-medium text-gray-600">Total Leads Processed</p>
                            <p id="totalLeadsMetric" class="text-4xl font-bold text-blue-800 mt-2">0</p>
                        </div>
                        <div class="bg-green-50 p-6 rounded-lg shadow-sm text-center">
                            <i class="fas fa-check-circle text-green-600 text-3xl mb-3"></i>
                            <p class="text-lg font-medium text-gray-600">Qualified Leads (%)</p>
                            <p id="qualifiedLeadsMetric" class="text-4xl font-bold text-green-800 mt-2">0%</p>
                            <div class="progress-bar-container mt-3"><div id="qualifiedProgressBar" class="progress-bar bg-green-500" style="width: 0%;"></div></div>
                        </div>
                        <div class="bg-yellow-50 p-6 rounded-lg shadow-sm text-center">
                            <i class="fas fa-star text-yellow-600 text-3xl mb-3"></i>
                            <p class="text-lg font-medium text-gray-600">Average Lead Score</p>
                            <p id="avgLeadScoreMetric" class="text-4xl font-bold text-yellow-800 mt-2">0</p>
                        </div>
                        <div class="bg-red-50 p-6 rounded-lg shadow-sm text-center">
                            <i class="fas fa-times-circle text-red-600 text-3xl mb-3"></i>
                            <p class="text-lg font-medium text-gray-600">Unqualified Feedback Count</p>
                            <p id="unqualifiedFeedbackMetric" class="text-4xl font-bold text-red-800 mt-2">0</p>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-lg shadow-sm text-center">
                            <i class="fas fa-dollar-sign text-purple-600 text-3xl mb-3"></i>
                            <p class="text-lg font-medium text-gray-600">Avg. Budget (Qualified)</p>
                            <p id="avgQualifiedBudgetMetric" class="text-4xl font-bold text-purple-800 mt-2">$0</p>
                        </div>
                         <div class="bg-indigo-50 p-6 rounded-lg shadow-sm text-center">
                            <i class="fas fa-redo-alt text-indigo-600 text-3xl mb-3"></i>
                            <p class="text-lg font-medium text-gray-600">Model Adjustment Needed</p>
                            <p id="modelAdjustmentNeededMetric" class="text-4xl font-bold text-indigo-800 mt-2">0</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold text-gray-700 mb-4 mt-8">Lead Score Distribution</h3>
                    <div id="scoreDistributionChart" class="chart-container">
                        <div class="chart-row">
                            <span class="chart-label">0-20:</span>
                            <div class="chart-bar-visual bg-red-400" style="width: 0%;"><span id="scoreRange0-20-count">0</span></div>
                        </div>
                        <div class="chart-row">
                            <span class="chart-label">21-40:</span>
                            <div class="chart-bar-visual bg-orange-400" style="width: 0%;"><span id="scoreRange21-40-count">0</span></div>
                        </div>
                        <div class="chart-row">
                            <span class="chart-label">41-60:</span>
                            <div class="chart-bar-visual bg-yellow-400" style="width: 0%;"><span id="scoreRange41-60-count">0</span></div>
                        </div>
                        <div class="chart-row">
                            <span class="chart-label">61-80:</span>
                            <div class="chart-bar-visual bg-blue-400" style="width: 0%;"><span id="scoreRange61-80-count">0</span></div>
                        </div>
                        <div class="chart-row">
                            <span class="chart-label">81-100+:</span>
                            <div class="chart-bar-visual bg-green-400" style="width: 0%;"><span id="scoreRange81-100-count">0</span></div>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold text-gray-700 mb-4 mt-8">Leads by Source</h3>
                    <div id="leadSourceChart" class="chart-container">
                        <!-- Bars injected here -->
                    </div>

                    <h3 class="text-xl font-semibold text-gray-700 mb-4 mt-8">Leads by Industry</h3>
                    <div id="leadIndustryChart" class="chart-container">
                        <!-- Bars injected here -->
                    </div>
                </div>
            </div>

            <!-- Tab Content: Feedback Insights -->
            <div id="feedback-insights" class="tab-content">
                <div class="section">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Sales-Marketing Feedback Insights</h2>
                    <p class="text-gray-600 mb-6">Review feedback from sales on lead quality. This data is critical for refining lead generation strategies.</p>
                    <div id="feedbackList" class="divide-y divide-gray-200 max-h-[600px] overflow-y-auto custom-scrollbar">
                        <p class="text-gray-500 text-center py-4" id="noFeedbackMessage">No feedback recorded yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lead Detail Modal -->
    <div id="leadDetailModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Lead Details & Score Breakdown</h2>
            <div id="modalLeadDetails" class="space-y-3 text-gray-700">
                <p><strong>Name:</strong> <span id="modal-name"></span></p>
                <p><strong>Company:</strong> <span id="modal-company"></span></p>
                <p><strong>Email:</strong> <span id="modal-email"></span></p>
                <p><strong>Source:</strong> <span id="modal-source"></span></p>
                <p><strong>Industry:</strong> <span id="modal-industry"></span></p>
                <p><strong>Company Size:</strong> <span id="modal-companySize"></span> employees</p>
                <p><strong>Engagement:</strong> <span id="modal-engagement"></span>/10</p>
                <p><strong>Budget:</strong> <span id="modal-budget"></span></p>
                <p><strong>Phone:</strong> <span id="modal-phone"></span></p>
                <p><strong>Decision Maker:</strong> <span id="modal-decisionMaker"></span></p>
                <p><strong>Timeframe to Purchase:</strong> <span id="modal-timeframe"></span></p>
                <p><strong>Annual Revenue:</strong> <span id="modal-annualRevenue"></span></p>
                <p><strong>Source Campaign:</strong> <span id="modal-sourceCampaign"></span></p>
                <p class="text-xl font-bold mt-4">Calculated Score: <span id="modal-score" class="text-blue-600"></span></p>
                <p><strong>Qualification Status:</strong> <span id="modal-status" class="font-bold"></span>

                <h3 class="text-lg font-semibold mt-4">Score Contribution Breakdown:</h3>
                <ul id="modal-score-breakdown" class="list-disc list-inside text-sm text-gray-600 space-y-1">
                    <!-- Breakdown items will be injected here -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        // IIFE for encapsulation, simulating module structure in a single file
        (function() {
            // --- Global State ---
            let leads = [];
            let scoringRules = {
                industry: {
                    Technology: 20, Finance: 15, Healthcare: 10, Retail: 5,
                    Manufacturing: 8, Education: 7, Services: 12, Other: 0
                },
                companySizeFactor: 5,      // Score = (Company Size / 100) * Factor
                engagementWeight: 8,       // Score = Engagement Level * Weight
                leadSource: {
                    Website: 15, Referral: 25, LinkedIn: 10, Event: 20,
                    ColdCall: 3, Other: 0
                },
                budget: {
                    '0-9999': 0,
                    '10000-49999': 5,
                    '50000-99999': 10,
                    '100000-499999': 15,
                    '500000-999999': 20,
                    '1000000+': 25
                },
                revenueFactor: 2,          // Score = (Annual Revenue / 1000000) * Factor
                decisionMakerWeight: 10,   // Weight for decision maker
                timeframeImmediate: 5,     // Weight for immediate purchase
                qualifiedThreshold: 70     // Minimum score to be qualified
            };
            let modelAdjustmentNeededCount = 0; // Metric for feedback insights

            // --- UI Element References ---
            const els = {
                notificationContainer: document.getElementById('notification-container'),
                tabButtons: document.querySelectorAll('.tab-button'),
                tabContents: document.querySelectorAll('.tab-content'),
                addLeadForm: document.getElementById('addLeadForm'),
                leadsList: document.getElementById('leadsList'),
                noLeadsMessage: document.getElementById('noLeadsMessage'),
                feedbackList: document.getElementById('feedbackList'),
                noFeedbackMessage: document.getElementById('noFeedbackMessage'),
                saveScoringRulesBtn: document.getElementById('saveScoringRules'),

                // Scoring Rule Inputs (dynamic way to get them)
                ruleInputs: {},

                // Metric Displays
                totalLeadsMetric: document.getElementById('totalLeadsMetric'),
                qualifiedLeadsMetric: document.getElementById('qualifiedLeadsMetric'),
                qualifiedProgressBar: document.getElementById('qualifiedProgressBar'),
                avgLeadScoreMetric: document.getElementById('avgLeadScoreMetric'),
                unqualifiedFeedbackMetric: document.getElementById('unqualifiedFeedbackMetric'),
                avgQualifiedBudgetMetric: document.getElementById('avgQualifiedBudgetMetric'),
                modelAdjustmentNeededMetric: document.getElementById('modelAdjustmentNeededMetric'),

                // Chart Containers
                scoreDistributionChart: document.getElementById('scoreDistributionChart'),
                leadSourceChart: document.getElementById('leadSourceChart'),
                leadIndustryChart: document.getElementById('leadIndustryChart'),

                // Modal Elements
                leadDetailModal: document.getElementById('leadDetailModal'),
                closeModalButton: document.querySelector('.modal .close-button'),
                modalLeadDetails: document.getElementById('modalLeadDetails'),
                modalName: document.getElementById('modal-name'),
                modalCompany: document.getElementById('modal-company'),
                modalEmail: document.getElementById('modal-email'),
                modalSource: document.getElementById('modal-source'),
                modalIndustry: document.getElementById('modal-industry'),
                modalCompanySize: document.getElementById('modal-companySize'),
                modalEngagement: document.getElementById('modal-engagement'),
                modalBudget: document.getElementById('modal-budget'),
                modalPhone: document.getElementById('modal-phone'),
                modalDecisionMaker: document.getElementById('modal-decisionMaker'),
                modalTimeframe: document.getElementById('modal-timeframe'),
                modalAnnualRevenue: document.getElementById('modal-annualRevenue'),
                modalSourceCampaign: document.getElementById('modal-sourceCampaign'),
                modalScore: document.getElementById('modal-score'),
                modalStatus: document.getElementById('modal-status'),
                modalScoreBreakdown: document.getElementById('modal-score-breakdown')
            };

            // Dynamically collect rule input elements
            document.querySelectorAll('#scoring-config input, #scoring-config select').forEach(input => {
                if (input.id.startsWith('rule-')) {
                    els.ruleInputs[input.id] = input;
                }
            });

            // --- Utility Functions ---

            /**
             * Generates a unique ID for an item.
             * @returns {string} A unique ID.
             */
            function generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
            }

            /**
             * Displays a transient notification message to the user.
             * @param {string} message - The message to display.
             * @param {boolean} isError - True if it's an error notification, false for success.
             */
            function showNotification(message, isError = false) {
                const notificationDiv = document.createElement('div');
                notificationDiv.classList.add('notification');
                if (isError) {
                    notificationDiv.classList.add('error');
                }
                notificationDiv.textContent = message;
                els.notificationContainer.appendChild(notificationDiv);

                setTimeout(() => {
                    notificationDiv.classList.add('show');
                }, 10); // Small delay to trigger CSS transition

                setTimeout(() => {
                    notificationDiv.classList.remove('show');
                    notificationDiv.addEventListener('transitionend', () => notificationDiv.remove());
                }, 3000); // Hide after 3 seconds
            }

            // --- Local Storage Management ---

            /**
             * Loads data from localStorage.
             */
            function loadData() {
                try {
                    const storedLeads = localStorage.getItem('leads');
                    const storedScoringRules = localStorage.getItem('scoringRules');
                    const storedModelAdjustmentCount = localStorage.getItem('modelAdjustmentNeededCount');

                    if (storedLeads) {
                        leads = JSON.parse(storedLeads);
                    }
                    if (storedScoringRules) {
                        scoringRules = JSON.parse(storedScoringRules);
                    }
                    if (storedModelAdjustmentCount) {
                        modelAdjustmentNeededCount = parseInt(storedModelAdjustmentCount, 10);
                    }
                } catch (e) {
                    console.error("Error loading data from localStorage:", e);
                    showNotification("Failed to load saved data. Data might be corrupted.", true);
                }
                populateScoringRulesUI();
                renderLeads();
                updateMetrics();
                renderFeedbackInsights();
            }

            /**
             * Saves data to localStorage.
             */
            function saveData() {
                try {
                    localStorage.setItem('leads', JSON.stringify(leads));
                    localStorage.setItem('scoringRules', JSON.stringify(scoringRules));
                    localStorage.setItem('modelAdjustmentNeededCount', modelAdjustmentNeededCount.toString());
                } catch (e) {
                    console.error("Error saving data to localStorage:", e);
                    showNotification("Failed to save data. Please check browser storage settings.", true);
                }
            }

            // --- UI Rendering Functions ---

            /**
             * Populates the scoring rules input fields with current values.
             */
            function populateScoringRulesUI() {
                for (const key in els.ruleInputs) {
                    const id = key;
                    const parts = id.split('-'); // e.g., ['rule', 'industry', 'Technology']
                    let value;

                    if (parts[1] === 'industry' || parts[1] === 'leadSource') {
                        value = scoringRules[parts[1]][parts[2]];
                    } else {
                        value = scoringRules[parts[1]];
                    }
                    els.ruleInputs[id].value = value;
                }
            }

            /**
             * Calculates the score for a single lead based on current scoring rules.
             * Returns the score and a breakdown of how it was calculated.
             * @param {object} lead - The lead object.
             * @returns {{score: number, breakdown: Array<{rule: string, points: number}>}} The calculated lead score and breakdown.
             */
            function calculateLeadScore(lead) {
                let score = 0;
                const breakdown = [];

                // Industry scoring
                const industryScore = scoringRules.industry[lead.industry] || scoringRules.industry.Other;
                score += industryScore;
                breakdown.push({ rule: `Industry (${lead.industry})`, points: industryScore });

                // Company size scoring
                const companySizeScore = Math.round((lead.companySize / 100) * scoringRules.companySizeFactor);
                score += companySizeScore;
                breakdown.push({ rule: `Company Size (${lead.companySize} employees)`, points: companySizeScore });

                // Engagement level scoring
                const engagementScore = lead.engagement * scoringRules.engagementWeight;
                score += engagementScore;
                breakdown.push({ rule: `Engagement Level (${lead.engagement}/10)`, points: engagementScore });

                // Lead Source scoring
                const leadSourceScore = scoringRules.leadSource[lead.leadSource] || scoringRules.leadSource.Other;
                score += leadSourceScore;
                breakdown.push({ rule: `Lead Source (${lead.leadSource})`, points: leadSourceScore });

                // Budget scoring (range)
                let budgetScore = 0;
                if (lead.budget && scoringRules.budget) {
                    budgetScore = scoringRules.budget[lead.budget] || 0;
                    score += budgetScore;
                    breakdown.push({ rule: `Budget (${lead.budget})`, points: budgetScore });
                }

                // Annual Revenue scoring
                let revenueScore = 0;
                if (lead.annualRevenue && lead.annualRevenue > 0) {
                    revenueScore = Math.round((lead.annualRevenue / 1000000) * scoringRules.revenueFactor);
                    score += revenueScore;
                    breakdown.push({ rule: `Annual Revenue ($${lead.annualRevenue})`, points: revenueScore });
                }

                // Decision Maker scoring
                if (lead.decisionMaker === 'Yes') {
                    score += scoringRules.decisionMakerWeight;
                    breakdown.push({ rule: `Decision Maker`, points: scoringRules.decisionMakerWeight });
                }

                // Timeframe scoring
                if (lead.timeframe === 'Immediately') {
                    score += scoringRules.timeframeImmediate;
                    breakdown.push({ rule: `Timeframe to Purchase (Immediate)`, points: scoringRules.timeframeImmediate });
                }

                // Cap the score at 100 and ensure it's not negative for display purposes
                const finalScore = Math.min(100, Math.max(0, Math.round(score)));
                breakdown.push({ rule: `Final Score (Capped 0-100)`, points: finalScore });

                return { score: finalScore, breakdown };
            }

            /**
             * Renders all leads to the UI in the 'Lead List' tab.
             */
            function renderLeads() {
                els.leadsList.innerHTML = '';
                if (leads.length === 0) {
                    els.noLeadsMessage.style.display = 'block';
                } else {
                    els.noLeadsMessage.style.display = 'none';
                    leads.sort((a, b) => b.timestamp - a.timestamp).forEach(lead => { // Sort by newest first
                        const { score, breakdown } = calculateLeadScore(lead);
                        const isQualified = score >= scoringRules.qualifiedThreshold;
                        const statusClass = isQualified ? 'lead-status-qualified' : 'lead-status-unqualified';

                        const leadElement = document.createElement('div');
                        leadElement.classList.add('lead-item', 'space-y-2', 'md:flex', 'md:justify-between', 'md:items-center', 'md:space-y-0', 'hover:bg-gray-50', 'transition-colors', 'duration-200');
                        leadElement.dataset.id = lead.id; // Store ID for click listener
                        leadElement.innerHTML = `
                            <div>
                                <p class="text-lg font-semibold text-gray-800">${lead.name} <span class="text-gray-500 font-normal">(${lead.company})</span></p>
                                <p class="text-sm text-gray-600">Source: ${lead.leadSource} | Industry: ${lead.industry} | Size: ${lead.companySize}</p>
                                <p class="text-md text-gray-700">Score: <span class="font-bold">${score}</span> | Status: <span class="${statusClass}">${isQualified ? 'Qualified' : 'Unqualified'}</span></p>
                                <p class="text-xs text-gray-500 mt-1">Sales Feedback: <span class="feedback-text font-medium">${lead.feedback || 'Pending'}</span></p>
                            </div>
                            <div class="flex space-x-2 mt-2 md:mt-0">
                                <button data-id="${lead.id}" data-feedback="Converted" class="btn btn-success btn-feedback"><i class="fas fa-thumbs-up"></i> Converted</button>
                                <button data-id="${lead.id}" data-feedback="Unqualified" class="btn btn-danger btn-feedback"><i class="fas fa-thumbs-down"></i> Unqualified</button>
                            </div>
                        `;
                        els.leadsList.appendChild(leadElement);
                    });

                    // Attach event listeners for feedback buttons and lead item clicks
                    document.querySelectorAll('.btn-feedback').forEach(button => {
                        button.addEventListener('click', handleFeedback);
                    });
                    document.querySelectorAll('.lead-item').forEach(item => {
                        item.addEventListener('click', handleLeadItemClick);
                    });
                }
            }

            /**
             * Renders the feedback insights tab content.
             */
            function renderFeedbackInsights() {
                els.feedbackList.innerHTML = '';
                const feedbackLeads = leads.filter(lead => lead.feedback !== '');
                if (feedbackLeads.length === 0) {
                    els.noFeedbackMessage.style.display = 'block';
                } else {
                    els.noFeedbackMessage.style.display = 'none';
                    feedbackLeads.forEach(lead => {
                        const feedbackElement = document.createElement('div');
                        feedbackElement.classList.add('lead-item', 'space-y-2');
                        feedbackElement.innerHTML = `
                            <p class="text-lg font-semibold text-gray-800">${lead.name} <span class="text-gray-500 font-normal">(${lead.company})</span></p>
                            <p class="text-md text-gray-700">Feedback: <span class="font-bold ${lead.feedback === 'Converted' ? 'text-green-600' : 'text-red-600'}">${lead.feedback}</span></p>
                            <p class="text-sm text-gray-600">Lead Source: ${lead.leadSource} | Industry: ${lead.industry}</p>
                        `;
                        els.feedbackList.appendChild(feedbackElement);
                    });
                }
            }


            /**
             * Updates all lead metrics and the chart displays.
             */
            function updateMetrics() {
                const totalLeads = leads.length;
                let qualifiedLeadsCount = 0;
                let totalScore = 0;
                let unqualifiedFeedbackCount = 0;
                let totalQualifiedBudget = 0;

                const scoreDistribution = { '0-20': 0, '21-40': 0, '41-60': 0, '61-80': 0, '81-100': 0 };
                const leadSourceCounts = {};
                const leadIndustryCounts = {};

                leads.forEach(lead => {
                    const { score } = calculateLeadScore(lead);
                    totalScore += score;
                    if (score >= scoringRules.qualifiedThreshold) {
                        qualifiedLeadsCount++;
                        if (lead.budget) totalQualifiedBudget += lead.budget;
                    }
                    if (lead.feedback === 'Unqualified') {
                        unqualifiedFeedbackCount++;
                    }

                    // Categorize for score distribution chart
                    if (score <= 20) scoreDistribution['0-20']++;
                    else if (score <= 40) scoreDistribution['21-40']++;
                    else if (score <= 60) scoreDistribution['41-60']++;
                    else if (score <= 80) scoreDistribution['61-80']++;
                    else scoreDistribution['81-100']++;

                    // Count lead sources
                    leadSourceCounts[lead.leadSource] = (leadSourceCounts[lead.leadSource] || 0) + 1;
                    // Count lead industries
                    leadIndustryCounts[lead.industry] = (leadIndustryCounts[lead.industry] || 0) + 1;
                });

                const percentageQualified = totalLeads === 0 ? 0 : ((qualifiedLeadsCount / totalLeads) * 100).toFixed(1);
                const avgLeadScore = totalLeads === 0 ? 0 : (totalScore / totalLeads).toFixed(1);
                const avgQualifiedBudget = qualifiedLeadsCount === 0 ? 0 : (totalQualifiedBudget / qualifiedLeadsCount);

                els.totalLeadsMetric.textContent = totalLeads;
                els.qualifiedLeadsMetric.textContent = `${percentageQualified}%`;
                els.qualifiedProgressBar.style.width = `${percentageQualified}%`;
                els.avgLeadScoreMetric.textContent = avgLeadScore;
                els.unqualifiedFeedbackMetric.textContent = unqualifiedFeedbackCount;
                els.avgQualifiedBudgetMetric.textContent = `$${avgQualifiedBudget.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
                els.modelAdjustmentNeededMetric.textContent = modelAdjustmentNeededCount;

                // Update score distribution chart
                const scoreChartBars = {
                    '0-20': document.querySelector('#scoreDistributionChart .bg-red-400'),
                    '21-40': document.querySelector('#scoreDistributionChart .bg-orange-400'),
                    '41-60': document.querySelector('#scoreDistributionChart .bg-yellow-400'),
                    '61-80': document.querySelector('#scoreDistributionChart .bg-blue-400'),
                    '81-100': document.querySelector('#scoreDistributionChart .bg-green-400')
                };
                const scoreChartCounts = {
                    '0-20': document.getElementById('scoreRange0-20-count'),
                    '21-40': document.getElementById('scoreRange21-40-count'),
                    '41-60': document.getElementById('scoreRange41-60-count'),
                    '61-80': document.getElementById('scoreRange61-80-count'),
                    '81-100': document.getElementById('scoreRange81-100-count')
                };

                const maxScoreCount = Math.max(...Object.values(scoreDistribution), 1);
                for (const range in scoreDistribution) {
                    const width = (scoreDistribution[range] / maxScoreCount) * 100;
                    scoreChartBars[range].style.width = `${width > 0 ? Math.max(5, width) : 0}%`; // Min width for visibility
                    scoreChartCounts[range].textContent = scoreDistribution[range];
                }

                // Render Leads by Source Chart
                renderGenericChart(els.leadSourceChart, leadSourceCounts);

                // Render Leads by Industry Chart
                renderGenericChart(els.leadIndustryChart, leadIndustryCounts);
            }

            /**
             * Renders a generic bar chart based on provided counts.
             * @param {HTMLElement} container - The HTML element to render the chart into.
             * @param {object} dataCounts - An object where keys are categories and values are counts.
             */
            function renderGenericChart(container, dataCounts) {
                container.innerHTML = '';
                const total = Object.values(dataCounts).reduce((sum, count) => sum + count, 0);
                if (total === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">No data for this chart yet.</p>';
                    return;
                }

                const sortedData = Object.entries(dataCounts).sort(([, a], [, b]) => b - a);
                const maxCount = Math.max(...Object.values(dataCounts));

                sortedData.forEach(([label, count]) => {
                    const percentage = total === 0 ? 0 : (count / total) * 100;
                    const barWidth = (count / maxCount) * 100; // Relative to max count for visual scaling

                    const chartRow = document.createElement('div');
                    chartRow.classList.add('chart-row');
                    chartRow.innerHTML = `
                        <span class="chart-label">${label}:</span>
                        <div class="chart-bar-visual" style="width: ${barWidth > 0 ? Math.max(5, barWidth) : 0}%; background-color: ${getBarColor(label)};">
                            <span>${count} (${percentage.toFixed(0)}%)</span>
                        </div>
                    `;
                    container.appendChild(chartRow);
                });
            }

            /**
             * Returns a consistent color for chart bars based on label.
             * @param {string} label - The label for the bar.
             * @returns {string} Hex color code.
             */
            function getBarColor(label) {
                const colors = {
                    'Website': '#4299E1', 'Referral': '#48BB78', 'LinkedIn': '#667EEA', 'Event': '#ED8936',
                    'ColdCall': '#E53E3E', 'Other': '#A0AEC0',
                    'Technology': '#38B2AC', 'Finance': '#9F7AEA', 'Healthcare': '#F6AD55', 'Retail': '#ECC94B',
                    'Manufacturing': '#4FD1C5', 'Education': '#81E6D9', 'Services': '#9DECF9'
                };
                return colors[label] || '#A0AEC0'; // Default gray for unknown
            }


            // --- Event Handlers ---

            /**
             * Handles tab switching.
             * @param {Event} event - The click event.
                         */
            function handleTabClick(event) {
                const clickedTab = event.currentTarget;
                const tabId = clickedTab.dataset.tab;

                els.tabButtons.forEach(button => button.classList.remove('active'));
                clickedTab.classList.add('active');

                els.tabContents.forEach(content => {
                    if (content.id === tabId) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });

                // Update metrics and feedback insights when switching to those tabs
                if (tabId === 'analytics') {
                    updateMetrics();
                } else if (tabId === 'feedback-insights') {
                    renderFeedbackInsights();
                }
            }

            /**
             * Handles the form submission for adding a new lead.
             * @param {Event} event - The form submission event.
             */
            function handleAddLead(event) {
                event.preventDefault();

                // Get values and trim whitespace
                const name = document.getElementById('leadName').value.trim();
                const company = document.getElementById('leadCompany').value.trim();
                const email = document.getElementById('leadEmail').value.trim();
                const source = document.getElementById('leadSource').value;
                const managementLevel = document.getElementById('leadManagementLevel').value;
                const jobFunction = document.getElementById('leadJobFunction').value;
                const department = document.getElementById('leadDepartment').value;
                const industry = document.getElementById('leadIndustry').value;
                const country = document.getElementById('leadCountry').value;
                const companySize = parseInt(document.getElementById('leadCompanySize').value);
                const engagement = parseInt(document.getElementById('leadEngagement').value);
                const budget = document.getElementById('leadBudget').value;
                const phone = document.getElementById('leadPhone').value.trim();
                const decisionMaker = document.getElementById('leadDecisionMaker').value;
                const timeframe = document.getElementById('leadTimeframe').value;
                const annualRevenue = document.getElementById('leadAnnualRevenue').value;
                const sourceCampaign = document.getElementById('leadSourceCampaign').value.trim();

                // Basic validation
                if (!name || !company || !email || !source || !managementLevel || !jobFunction || !department || !industry || !country || !phone || !decisionMaker || !timeframe || !annualRevenue || !budget || !sourceCampaign) {
                    showNotification('Please fill in all required text/select fields.', true);
                    return;
                }
                if (isNaN(companySize) || companySize <= 0) {
                    showNotification('Company Size must be a positive number.', true);
                    return;
                }
                if (isNaN(engagement) || engagement < 1 || engagement > 10) {
                    showNotification('Engagement Level must be a number between 1 and 10.', true);
                    return;
                }

                // Create new lead object
                const newLead = {
                    id: generateId(),
                    timestamp: Date.now(), // For sorting and tracking
                    name, company, email, leadSource: source, managementLevel, jobFunction, department, industry, country, companySize, engagement, budget,
                    phone, decisionMaker, timeframe, annualRevenue, sourceCampaign,
                    feedback: '' // To store sales-marketing alignment feedback
                };

                // Add lead to array and save
                leads.push(newLead);
                saveData();
                renderLeads();
                updateMetrics();
                showNotification('Lead added successfully and score calculated!');
                addLeadForm.reset(); // Clear the form
            }



            /**
             * Handles saving of updated scoring rules.
             */
            function handleSaveScoringRules() {
                try {
                    // Update industry weights
                    scoringRules.industry.Technology = parseInt(els.ruleInputs['rule-industry-Technology'].value);
                    scoringRules.industry.Finance = parseInt(els.ruleInputs['rule-industry-Finance'].value);
                    scoringRules.industry.Healthcare = parseInt(els.ruleInputs['rule-industry-Healthcare'].value);
                    scoringRules.industry.Retail = parseInt(els.ruleInputs['rule-industry-Retail'].value);
                    scoringRules.industry.Manufacturing = parseInt(els.ruleInputs['rule-industry-Manufacturing'].value);
                    scoringRules.industry.Education = parseInt(els.ruleInputs['rule-industry-Education'].value);
                    scoringRules.industry.Services = parseInt(els.ruleInputs['rule-industry-Services'].value);
                    scoringRules.industry.Other = parseInt(els.ruleInputs['rule-industry-Other'].value);

                    // Update lead source weights
                    scoringRules.leadSource.Website = parseInt(els.ruleInputs['rule-leadSource-Website'].value);
                    scoringRules.leadSource.Referral = parseInt(els.ruleInputs['rule-leadSource-Referral'].value);
                    scoringRules.leadSource.LinkedIn = parseInt(els.ruleInputs['rule-leadSource-LinkedIn'].value);
                    scoringRules.leadSource.Event = parseInt(els.ruleInputs['rule-leadSource-Event'].value);
                    scoringRules.leadSource.ColdCall = parseInt(els.ruleInputs['rule-leadSource-ColdCall'].value);
                    scoringRules.leadSource.Other = parseInt(els.ruleInputs['rule-leadSource-Other'].value);


                    scoringRules.companySizeFactor = parseFloat(els.ruleInputs['rule-companySizeFactor'].value);
                    scoringRules.engagementWeight = parseInt(els.ruleInputs['rule-engagementWeight'].value);
                    scoringRules.budgetFactor = parseFloat(els.ruleInputs['rule-budgetFactor'].value);
                    scoringRules.revenueFactor = parseFloat(els.ruleInputs['rule-revenueFactor'].value);
                    scoringRules.decisionMakerWeight = parseInt(els.ruleInputs['rule-decisionMakerWeight'].value);
                    scoringRules.timeframeImmediate = parseInt(els.ruleInputs['rule-timeframeImmediate'].value);
                    scoringRules.qualifiedThreshold = parseInt(els.ruleInputs['rule-qualifiedThreshold'].value);

                    // Basic validation for numbers
                    for (const key in scoringRules) {
                        if (typeof scoringRules[key] === 'object') { // Nested objects (industry, leadSource)
                            for (const subKey in scoringRules[key]) {
                                if (isNaN(scoringRules[key][subKey])) {
                                    showNotification(`Invalid number for ${key} - ${subKey}. Please re-enter.`, true);
                                    return;
                                }
                            }
                        } else { // Direct properties
                            if (isNaN(scoringRules[key])) {
                                showNotification(`Invalid number for ${key}. Please re-enter.`, true);
                                return;
                            }
                        }
                    }

                    saveData();
                    renderLeads(); // Re-render leads with new scores
                    updateMetrics(); // Update metrics based on new scores
                    showNotification('Scoring rules saved and applied successfully!');
                } catch (e) {
                    console.error("Error saving scoring rules:", e);
                    showNotification('Failed to save scoring rules. Please check your inputs.', true);
                }
            }

            /**
             * Handles simulated sales-marketing alignment feedback.
             * @param {Event} event - The click event from the feedback button.
             */
            function handleFeedback(event) {
                event.stopPropagation(); // Prevent lead item click
                const leadId = event.target.dataset.id;
                const feedbackType = event.target.dataset.feedback; // 'Converted' or 'Unqualified'

                const leadIndex = leads.findIndex(l => l.id === leadId);
                if (leadIndex > -1) {
                    const lead = leads[leadIndex];
                    // Only update if feedback is different or empty
                    if (lead.feedback !== feedbackType) {
                        lead.feedback = feedbackType; // Update lead object with feedback

                        // Simulate impact on lead scoring or future lead generation parameters
                        // This is a simplified example for the prototype. In a real system, this would involve
                        // ML models or more complex, data-driven adjustments to lead generation parameters
                        // (e.g., adjust ad targeting, content strategy).
                        if (feedbackType === 'Unqualified') {
                            modelAdjustmentNeededCount++; // Increment a counter indicating need for review
                            showNotification(`Feedback "${feedbackType}" recorded for ${lead.name}. Model adjustment noted.`);
                        } else if (feedbackType === 'Converted') {
                            showNotification(`Feedback "${feedbackType}" recorded for ${lead.name}. Great news!`);
                        }
                        leads[leadIndex] = lead; // Update the lead in the array
                        saveData();
                        renderLeads(); // Re-render to show updated feedback
                        updateMetrics(); // Update metrics, especially the unqualified count and model adjustment
                        renderFeedbackInsights(); // Update feedback list
                    } else {
                         showNotification(`Feedback for ${lead.name} is already "${feedbackType}".`, false);
                    }
                }
            }

            /**
             * Handles clicking on a lead item to show details in a modal.
             * @param {Event} event - The click event from the lead item.
             */
            function handleLeadItemClick(event) {
                const leadId = event.currentTarget.dataset.id;
                const lead = leads.find(l => l.id === leadId);

                if (lead) {
                    const { score, breakdown } = calculateLeadScore(lead);
                    const isQualified = score >= scoringRules.qualifiedThreshold;

                    els.modalName.textContent = lead.name;
                    els.modalCompany.textContent = lead.company;
                    els.modalEmail.textContent = lead.email;
                    els.modalSource.textContent = lead.leadSource;
                    els.modalIndustry.textContent = lead.industry;
                    els.modalCompanySize.textContent = lead.companySize;
                    els.modalEngagement.textContent = lead.engagement;
                    els.modalBudget.textContent = lead.budget > 0 ? `$${lead.budget.toLocaleString()}` : 'N/A';
                    els.modalPhone.textContent = lead.phone;
                    els.modalDecisionMaker.textContent = lead.decisionMaker;
                    els.modalTimeframe.textContent = lead.timeframe;
                    els.modalAnnualRevenue.textContent = lead.annualRevenue;
                    els.modalSourceCampaign.textContent = lead.sourceCampaign;
                    els.modalScore.textContent = score;
                    els.modalStatus.textContent = isQualified ? 'Qualified' : 'Unqualified';
                    els.modalStatus.className = isQualified ? 'font-bold text-green-600' : 'font-bold text-red-600';

                    // Populate score breakdown
                    els.modalScoreBreakdown.innerHTML = '';
                    breakdown.forEach(item => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${item.rule}: ${item.points} points`;
                        els.modalScoreBreakdown.appendChild(listItem);
                    });

                    els.leadDetailModal.style.display = 'flex'; // Show modal
                }
            }

            /**
             * Closes the lead detail modal.
             */
            function closeLeadDetailModal() {
                els.leadDetailModal.style.display = 'none';
            }

            // --- Initialization ---
            document.addEventListener('DOMContentLoaded', () => {
                loadData(); // Load initial data

                // Attach event listeners for tabs
                els.tabButtons.forEach(button => {
                    button.addEventListener('click', handleTabClick);
                });

                // Attach event listeners for forms and buttons
                els.addLeadForm.addEventListener('submit', handleAddLead);
                els.saveScoringRulesBtn.addEventListener('click', handleSaveScoringRules);
                els.closeModalButton.addEventListener('click', closeLeadDetailModal);
                window.addEventListener('click', (event) => {
                    if (event.target === els.leadDetailModal) {
                        closeLeadDetailModal();
                    }
                });

                // Set initial active tab
                document.getElementById('tab-lead-entry').click();

                // --- Dynamic Job Function Filtering ---
                const departmentToJobFunctions = {
                    'C-Suite': [
                        'Executive','Finance Executive','Founder','Human Resources Executive','Information Technology Executive','Legal Executive','Marketing Executive','Medical & Health Executive','Operations Executive','Sales Leader'
                    ],
                    'Consulting': ['Consultant'],
                    'Design': ['All Design','Product or UI/UX Design','Graphic / Visual / Brand Design'],
                    'Education': ['Teacher','Principal','Superintendent','Professor'],
                    'Engineering & Technical': [
                        'Artificial Intelligence / Machine Learning','Bioengineering','Biometrics','Business Intelligence','Chemical Engineering','Cloud / Mobility','Data Science','DevOps','Digital Transformation','Emerging Technology / Innovation','Engineering & Technical','Industrial Engineering','Mechanic','Mobile Development','Project Management','Research & Development','Scrum Master / Agile Coach','Software Development','Support / Technical Services','Technician','Technology Operations','Test / Quality Assurance','UI / UX','Web Development'
                    ],
                    'Finance': [
                        'Accounting','Finance','Financial Planning & Analysis','Financial Reporting','Financial Strategy','Financial Systems','Internal Audit & Control','Investor Relations','Mergers & Acquisitions','Real Estate Finance','Financial Risk','Shared Services','Sourcing / Procurement','Tax','Treasury'
                    ],
                    'Human Resources': [
                        'Compensation & Benefits','Culture, Diversity & Inclusion','Employee & Labor Relations','Health & Safety','Human Resource Information System','Human Resources','HR Business Partner','Learning & Development','Organizational Development','Recruiting & Talent Acquisition','Talent Management','Workforce Management','People Operations'
                    ],
                    'Information Technology': [
                        'Application Development','Business Service Management / ITSM','Collaboration & Web App','Data Center','Data Warehouse','Database Administration','eCommerce Development','Enterprise Architecture','Help Desk / Desktop Services','HR / Financial / ERP Systems','Information Security','Information Technology','Infrastructure','IT Asset Management','IT Audit / IT Compliance','IT Operations','IT Procurement','IT Strategy','IT Training','Networking','Project & Program Management','Quality Assurance','Retail / Store Systems','Servers','Storage & Disaster Recovery','Telecommunications','Virtualization'
                    ],
                    'Legal': [
                        'Acquisitions','Compliance','Contracts','Corporate Secretary','eDiscovery','Ethics','Governance','Governmental Affairs & Regulatory Law','Intellectual Property & Patent','Labor & Employment','Lawyer / Attorney','Legal','Legal Counsel','Legal Operations','Litigation','Privacy'
                    ],
                    'Marketing': [
                        'Advertising','Brand Management','Content Marketing','Customer Experience','Customer Marketing','Demand Generation','Digital Marketing','eCommerce Marketing','Event Marketing','Field Marketing','Lead Generation','Marketing','Marketing Analytics / Insights','Marketing Communications','Marketing Operations','Product Marketing','Public Relations','Search Engine Optimization / Pay Per Click','Social Media Marketing','Strategic Communications','Technical Marketing'
                    ],
                    'Medical & Health': [
                        'Anesthesiology','Chiropractics','Clinical Systems','Dentistry','Dermatology','Doctors / Physicians','Epidemiology','First Responder','Infectious Disease','Medical Administration','Medical Education & Training','Medical Research','Medicine','Neurology','Nursing','Nutrition & Dietetics','Obstetrics / Gynecology','Oncology','Opthalmology','Optometry','Orthopedics','Pathology','Pediatrics','Pharmacy','Physical Therapy','Psychiatry','Psychology','Public Health','Radiology','Social Work'
                    ],
                    'Operations': [
                        'Call Center','Construction','Corporate Strategy','Customer Service / Support','Enterprise Resource Planning','Facilities Management','Leasing','Logistics','Office Operations','Operations','Physical Security','Project Development','Quality Management','Real Estate','Safety','Store Operations','Supply Chain'
                    ],
                    'Product': ['Product Development','Product Management'],
                    'Sales': [
                        'Account Management','Business Development','Channel Sales','Customer Retention & Development','Customer Success','Field / Outside Sales','Inside Sales','Partnerships','Revenue Operations','Sales','Sales Enablement','Sales Engineering','Sales Operations','Sales Training'
                    ]
                };
                const departmentSelect = document.getElementById('leadDepartment');
                const jobFunctionSelect = document.getElementById('leadJobFunction');
                if (departmentSelect && jobFunctionSelect) {
                    departmentSelect.addEventListener('change', function() {
                        const dept = this.value;
                        jobFunctionSelect.innerHTML = '<option value="">Select Job Function</option>';
                        if (departmentToJobFunctions[dept]) {
                            departmentToJobFunctions[dept].forEach(fn => {
                                const opt = document.createElement('option');
                                opt.value = fn;
                                opt.textContent = fn;
                                jobFunctionSelect.appendChild(opt);
                            });
                        }
                    });
                }
            });

        })(); // End of IIFE
    </script>
</body>
</html>
